---
phase: 19-dashboard-transformation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/StatsCard.tsx
  - src/pages/Dashboard.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard overview tab renders a 3-column grid layout with main content area and a right widget column"
    - "Top row shows 6 pastel-colored stat cards — each card has a distinct entity color background, not uniform styling"
    - "Stat cards enter with staggered animation (Y-axis + opacity only, RTL-safe)"
    - "StatsCard with coloredBg shows large text-4xl numbers and a distinct icon container (bg-white/50 contrast fix)"
  artifacts:
    - path: "src/pages/Dashboard.tsx"
      provides: "3-column grid layout for overview tab, stat cards with entity colors and stagger animation"
      contains: "grid-cols-1 lg:grid-cols-"
    - path: "src/components/ui/StatsCard.tsx"
      provides: "Enhanced StatsCard with icon contrast fix for coloredBg mode, trend badge pill, larger numbers"
      contains: "bg-white/50"
  key_links:
    - from: "src/pages/Dashboard.tsx"
      to: "src/components/ui/StatsCard.tsx"
      via: "coloredBg prop with entity color names"
      pattern: "coloredBg"
---

<objective>
Restructure the Dashboard overview tab into a 3-column layout with a main content area and a right widget column, upgrade stat cards to use per-entity pastel colors with coloredBg, enhance StatsCard component for data-dominant presentation, and add staggered entrance animations (MOTN-02, MOTN-04).

Purpose: Transform the dashboard from a single-column card grid into a zoned, data-dominant command center layout. The 3-column grid and colorful stat cards are the structural backbone that the right-column widgets (Plan 19-02) attach to.

Output: Dashboard.tsx overview tab uses CSS Grid 3-column layout at lg breakpoint; StatsCard enhanced with icon contrast fix, trend badge pill, and larger numbers when coloredBg is active; stat cards row has framer-motion stagger entrance.
</objective>

<execution_context>
@/home/yona279/.claude/get-shit-done/workflows/execute-plan.md
@/home/yona279/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-typography-scale-and-color-evolution/18-03-SUMMARY.md
@.planning/phases/19-dashboard-transformation/19-RESEARCH.md
@src/components/ui/StatsCard.tsx
@src/pages/Dashboard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance StatsCard for data-dominant coloredBg presentation</name>
  <files>src/components/ui/StatsCard.tsx</files>
  <action>
Upgrade StatsCard.tsx with three enhancements for the coloredBg mode:

1. **Icon container contrast fix:** When `coloredBg` is true, the icon container currently uses the same `colors.iconBg` class as the Card wrapper, creating insufficient contrast. When `coloredBg` is active, change the icon container background to `bg-white/50` instead of `colors.iconBg`. Use a conditional: `coloredBg ? 'bg-white/50' : colors.iconBg`. This creates a lighter "chip" on the pastel card background.

2. **Larger value number:** When `coloredBg` is true, use `text-4xl` instead of `text-3xl` for the value element. This makes the number the dominant visual element on colored stat cards. Conditional: `coloredBg ? 'text-4xl font-bold' : 'text-3xl font-bold'`.

3. **Trend badge pill styling:** Update the trend display (the `+5%` span) to use a pill badge shape when `coloredBg` is active. Add `rounded-full px-2 py-0.5 text-xs font-bold` classes, and use the entity's `iconBg` class as the pill background (since the card itself already has the entity bg, this creates a subtle deeper-tint pill). When NOT coloredBg, keep existing inline trend style.

Current structure to modify (lines 105-137):
- Line 106: Card wrapper — already handles coloredBg correctly (no change needed)
- Line 108: Icon container `div` — add coloredBg conditional for bg-white/50
- Line 116: Value `p` element — add coloredBg conditional for text-4xl
- Lines 119-126: Trend span — wrap in pill styling when coloredBg

Do NOT change the colorClasses map, the Card wrapper logic, or any legacy color entries. Only modify the render JSX.
  </action>
  <verify>Read StatsCard.tsx and confirm: (1) icon container uses `bg-white/50` when coloredBg is truthy, (2) value element uses `text-4xl` when coloredBg is truthy, (3) trend badge has pill classes when coloredBg is truthy. Run `npx tsc --noEmit src/components/ui/StatsCard.tsx 2>&1 | head -20` to check for TS errors (may fail due to existing project TS issues — focus on no NEW errors in this file).</verify>
  <done>StatsCard with coloredBg renders: bg-white/50 icon chip for contrast, text-4xl bold number for data dominance, trend pill badge with entity-colored background. Non-coloredBg usage is unchanged.</done>
</task>

<task type="auto">
  <name>Task 2: Restructure Dashboard overview tab to 3-column grid with entity-colored stat cards and stagger animation</name>
  <files>src/pages/Dashboard.tsx</files>
  <action>
Restructure the overview tab content in Dashboard.tsx. Only modify the `{activeTab === 'overview' && (...)}` block (lines 337-483). Do NOT touch any other tab content, the header, the tab navigation, the data loading logic, or the AdminHoursOverview component.

**Step 1: Add framer-motion import at top of file**

Add to existing imports:
```tsx
import { motion } from 'framer-motion'
```

**Step 2: Add animation variants near top of component (before the return statement)**

Add these constants inside the Dashboard component function, before the `return`:

```tsx
const cardRowVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: { staggerChildren: 0.08, delayChildren: 0.05 }
  }
}

const cardItemVariants = {
  hidden: { y: 16, opacity: 0 },
  visible: {
    y: 0,
    opacity: 1,
    transition: { type: 'spring', stiffness: 400, damping: 25 }
  }
}
```

These use Y-axis only (no X-axis transforms) for RTL safety per MOTN-04.

**Step 3: Replace the overview tab content**

Replace the entire `{activeTab === 'overview' && (...)}` block with the 3-column grid layout:

```tsx
{activeTab === 'overview' && (
  <div className="grid grid-cols-1 lg:grid-cols-[1fr_300px] gap-6">
    {/* Main content column */}
    <div className="space-y-6">
      {/* Stat cards row — staggered entrance */}
      <motion.div
        className="grid grid-cols-2 md:grid-cols-3 gap-4"
        variants={cardRowVariants}
        initial="hidden"
        animate="visible"
      >
        <motion.div variants={cardItemVariants}>
          <StatsCard
            title="תלמידים פעילים"
            value={loading ? "..." : stats.activeStudents.toString()}
            subtitle="תלמידים רשומים"
            icon={<Users />}
            color="students"
            coloredBg
            trend={stats.studentsTrend !== 0 ? {
              value: Math.abs(stats.studentsTrend),
              label: "מהחודש שעבר",
              direction: stats.studentsTrend > 0 ? "up" : "down"
            } : undefined}
          />
        </motion.div>

        <motion.div variants={cardItemVariants}>
          <StatsCard
            title="חברי סגל"
            value={loading ? "..." : stats.staffMembers.toString()}
            subtitle="מורים ומדריכים"
            icon={<GraduationCap />}
            color="teachers"
            coloredBg
          />
        </motion.div>

        <motion.div variants={cardItemVariants}>
          <StatsCard
            title="הרכבים פעילים"
            value={loading ? "..." : stats.activeOrchestras.toString()}
            subtitle="תזמורות וקבוצות"
            icon={<Music />}
            color="orchestras"
            coloredBg
          />
        </motion.div>

        <motion.div variants={cardItemVariants}>
          <StatsCard
            title="חזרות השבוע"
            value={loading ? "..." : stats.weeklyRehearsals.toString()}
            subtitle="מפגשים מתוכננים"
            icon={<Calendar />}
            color="rehearsals"
            coloredBg
          />
        </motion.div>

        <motion.div variants={cardItemVariants}>
          <StatsCard
            title="שיעורי תאוריה"
            value={loading ? "..." : stats.theoryLessonsThisWeek.toString()}
            subtitle="השבוע"
            icon={<BookOpen />}
            color="theory"
            coloredBg
          />
        </motion.div>

        <motion.div variants={cardItemVariants}>
          <StatsCard
            title="בגרויות פעילות"
            value={loading ? "..." : stats.activeBagruts.toString()}
            subtitle="תלמידים בתהליך"
            icon={<Award />}
            color="bagrut"
            coloredBg
          />
        </motion.div>
      </motion.div>

      {/* Teacher Room Schedule Table */}
      <DailyTeacherRoomTable />

      {/* Charts Grid */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <InstrumentDistributionChart
          schoolYearId={currentSchoolYear?._id}
          maxItems={8}
        />
        <ClassDistributionChart
          schoolYearId={currentSchoolYear?._id}
        />
      </div>
    </div>

    {/* Right widget column — populated in Plan 19-02 */}
    <div className="space-y-4">
      {/* Upcoming Events — inline for now, widget components come in 19-02 */}
      <Card>
        <div className="flex items-center justify-between mb-4">
          <h3 className="text-sm font-semibold text-foreground">אירועים קרובים</h3>
        </div>
        <div className="space-y-3">
          {loading ? (
            <div className="text-xs text-muted-foreground text-center py-4">טוען...</div>
          ) : upcomingEvents.length > 0 ? (
            upcomingEvents.map((event, index) => (
              <div key={index} className="flex items-start gap-3 p-2.5 rounded-lg bg-muted/40">
                <div className="w-7 h-7 rounded-md bg-orchestras-bg flex items-center justify-center flex-shrink-0">
                  <Music className="w-3.5 h-3.5 text-orchestras-fg" />
                </div>
                <div className="flex-1 min-w-0">
                  <p className="text-xs font-medium text-foreground truncate">{event.title}</p>
                  <p className="text-xs text-muted-foreground">{event.date} · {event.description}</p>
                </div>
              </div>
            ))
          ) : (
            <div className="text-xs text-muted-foreground text-center py-4">אין אירועים קרובים</div>
          )}
        </div>
      </Card>

      {/* Recent Activity */}
      <Card>
        <div className="flex items-center justify-between mb-4">
          <h3 className="text-sm font-semibold text-foreground">פעילות אחרונה</h3>
        </div>
        <div className="space-y-3">
          {loading ? (
            <div className="text-xs text-muted-foreground text-center py-4">טוען...</div>
          ) : recentActivities.length > 0 ? (
            recentActivities.map((activity, index) => (
              <div key={index} className="flex items-start gap-3 p-2.5 rounded-lg hover:bg-muted/30 transition-colors">
                <div className={`w-2 h-2 rounded-full mt-1.5 flex-shrink-0 ${
                  activity.color === 'primary' ? 'bg-students-fg' : 'bg-orchestras-fg'
                }`} />
                <div className="flex-1 min-w-0">
                  <p className="text-xs font-medium text-foreground truncate">{activity.title}</p>
                  <p className="text-xs text-muted-foreground truncate">{activity.description}</p>
                  <p className="text-xs text-muted-foreground/60 mt-0.5">{activity.time}</p>
                </div>
              </div>
            ))
          ) : (
            <div className="text-xs text-muted-foreground text-center py-4">אין פעילות אחרונה</div>
          )}
        </div>
      </Card>
    </div>
  </div>
)}
```

Key details:
- Use `lg:grid-cols-[1fr_300px]` (NOT xl — see Research Pitfall 3, content area is ~1086px with sidebar open)
- In RTL, first DOM child (main content) renders on the RIGHT (visual primary position in Hebrew), second child (widgets) renders on the LEFT — correct reading flow per Research
- Stat cards use `color="students"`, `color="teachers"`, etc. with `coloredBg` (entity colors, not legacy blue/green/teal/amber)
- Stats row uses `grid-cols-2 md:grid-cols-3` (fits in main column, NOT the old `lg:grid-cols-6` which was too cramped)
- Right column has inline upcoming events and activity for now — Plan 19-02 extracts these into widget components
- DO NOT use `layout` prop from framer-motion (Radix dropdown conflict)
- DO NOT add X-axis transforms in variants (RTL safety)
  </action>
  <verify>Read Dashboard.tsx and confirm: (1) overview tab content is inside a `grid grid-cols-1 lg:grid-cols-[1fr_300px]` wrapper, (2) stat cards use `color="students"/"teachers"/"orchestras"/"rehearsals"/"theory"/"bagrut"` with `coloredBg`, (3) `motion.div` wraps stat cards row with `variants={cardRowVariants}`, (4) right column has upcoming events and recent activity content, (5) other tabs (students, schedule, bagrut, hours) are UNCHANGED. Run `npx tsc --noEmit src/pages/Dashboard.tsx 2>&1 | head -30` to check for import errors.</verify>
  <done>Dashboard overview tab shows a 3-column layout: main content on the right (in RTL) with entity-colored stat cards that stagger in, DailyTeacherRoomTable, and chart grid; right widget column on the left (in RTL) with upcoming events and recent activity. Other tabs are untouched.</done>
</task>

</tasks>

<verification>
1. `grep -n "grid-cols-1 lg:grid-cols-\[1fr_300px\]" src/pages/Dashboard.tsx` — confirms 3-column grid
2. `grep -n "coloredBg" src/pages/Dashboard.tsx` — confirms all 6 stat cards use coloredBg
3. `grep -n "color=\"students\"\|color=\"teachers\"\|color=\"orchestras\"\|color=\"rehearsals\"\|color=\"theory\"\|color=\"bagrut\"" src/pages/Dashboard.tsx` — confirms entity color names
4. `grep -n "cardRowVariants\|cardItemVariants" src/pages/Dashboard.tsx` — confirms animation variants
5. `grep -n "bg-white/50" src/components/ui/StatsCard.tsx` — confirms icon contrast fix
6. `grep -n "text-4xl" src/components/ui/StatsCard.tsx` — confirms larger number for coloredBg
7. Verify that `activeTab === 'students'`, `activeTab === 'schedule'`, `activeTab === 'bagrut'`, `activeTab === 'hours'` sections are identical to current code
</verification>

<success_criteria>
- Dashboard overview tab renders 3-column grid layout at lg breakpoint
- All 6 stat cards use distinct entity colors (not legacy blue/green) with coloredBg backgrounds
- Stat cards have staggered Y-axis entrance animation
- StatsCard coloredBg mode shows bg-white/50 icon chip, text-4xl number, and trend pill badge
- Right column has placeholder widget content (events + activity)
- Non-overview tabs (students, schedule, bagrut, hours) are completely unchanged
- No new npm packages installed
</success_criteria>

<output>
After completion, create `.planning/phases/19-dashboard-transformation/19-01-SUMMARY.md`
</output>
