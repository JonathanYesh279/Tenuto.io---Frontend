---
phase: 08-domain-components-loading-states
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/components/feedback/EmptyState.tsx
  - src/components/feedback/ErrorState.tsx
  - src/pages/Teachers.tsx
  - src/pages/Students.tsx
  - src/pages/Orchestras.tsx
autonomous: true

must_haves:
  truths:
    - "Loading Teachers/Students/Orchestras list page shows table-shaped skeleton rows instead of a spinner"
    - "An empty Teachers table shows 'אין מורים עדיין' with a 'הוסף מורה' primary CTA button"
    - "An empty Students table shows 'אין תלמידים עדיין' with a 'הוסף תלמיד' primary CTA button"
    - "An empty Orchestras list shows 'אין תזמורות עדיין' with a 'תזמורת חדשה' primary CTA button"
    - "A network error on any list page shows a human-readable error message and a 'נסה שוב' retry button"
    - "No spinner (Loader animate-spin) visible on any of the 3 list pages during initial load"
  artifacts:
    - path: "src/components/feedback/EmptyState.tsx"
      provides: "Illustrated empty state with Hebrew CTA"
      exports: ["EmptyState"]
    - path: "src/components/feedback/ErrorState.tsx"
      provides: "Error display with retry button"
      exports: ["ErrorState"]
  key_links:
    - from: "src/pages/Teachers.tsx"
      to: "src/components/feedback/Skeleton.tsx"
      via: "import TableSkeleton, replaces Loader spinner"
      pattern: "import.*TableSkeleton.*from.*Skeleton"
    - from: "src/pages/Teachers.tsx"
      to: "src/components/feedback/EmptyState.tsx"
      via: "import EmptyState, replaces bare text"
      pattern: "import.*EmptyState.*from.*EmptyState"
    - from: "src/pages/Teachers.tsx"
      to: "src/components/feedback/ErrorState.tsx"
      via: "import ErrorState, replaces inline error div"
      pattern: "import.*ErrorState.*from.*ErrorState"
---

<objective>
Create EmptyState and ErrorState feedback components and wire all 3 list pages (Teachers, Students, Orchestras) with skeleton loading, empty states, and error states.

Purpose: Replace the spinner loading, bare text empty states, and ad-hoc error displays on the 3 primary list pages with consistent, polished feedback components. This directly satisfies success criteria 1, 2, and 3 of Phase 8.

Output: 2 new feedback components + 3 modified list pages with skeleton/empty/error state wiring.
</objective>

<execution_context>
@/home/yona279/.claude/get-shit-done/workflows/execute-plan.md
@/home/yona279/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-domain-components-loading-states/08-RESEARCH.md
@.planning/phases/08-domain-components-loading-states/08-01-SUMMARY.md

Key files to read before implementing:
@src/pages/Teachers.tsx — loading at line 537 (Loader spinner), error at line 548 (inline div), empty at line 825
@src/pages/Students.tsx — loading at line 795 (Loader spinner), error at line 806 (inline div), empty at line 1129
@src/pages/Orchestras.tsx — loading at line 254 (border-b-2 spinner), error at line 279 (inline banner)
@src/components/feedback/Skeleton.tsx — TableSkeleton from Plan 08-01
@src/components/ui/button.tsx — shadcn Button for CTA in EmptyState
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EmptyState and ErrorState feedback components</name>
  <files>
    src/components/feedback/EmptyState.tsx
    src/components/feedback/ErrorState.tsx
  </files>
  <action>
**EmptyState.tsx:**
- Props: `{ title: string; description?: string; icon?: React.ReactNode; action?: { label: string; onClick: () => void } }`.
- Layout: centered flex column with `py-16 text-center`.
- Icon area: if provided, render in a `w-16 h-16` container with `text-muted-foreground/40` color.
- Title: `text-lg font-semibold text-foreground mb-2`.
- Description: `text-sm text-muted-foreground mb-6 max-w-sm`.
- Action: if provided, render shadcn `<Button onClick={action.onClick}>{action.label}</Button>` (primary variant, default).
- Import `Button` from `@/components/ui/button`.
- Do NOT set `dir="rtl"` — it's already set on the root `<html>` element. Avoid redundant dir props.

**ErrorState.tsx:**
- Props: `{ message?: string; onRetry?: () => void }`.
- Default message: `'אירעה שגיאה בטעינת הנתונים'`.
- Layout: centered flex column with `py-16 text-center`.
- Icon: `<AlertCircle className="w-12 h-12 text-destructive mb-4" />` from lucide-react.
- Title: `text-lg font-semibold text-foreground mb-2` with text `'שגיאה בטעינת הנתונים'`.
- Message: `text-sm text-muted-foreground mb-6 max-w-sm` — shows the `message` prop.
- Retry: if `onRetry` provided, render `<Button variant="outline" onClick={onRetry}>נסה שוב</Button>`.
- Import `Button` from `@/components/ui/button`, `AlertCircle` from `lucide-react`.
  </action>
  <verify>
Read both files. Confirm:
1. EmptyState uses shadcn Button (not ActionButton from DesignSystem)
2. ErrorState uses `text-destructive` (CSS var) not `text-red-600` (hardcoded)
3. Neither file sets dir="rtl" explicitly
  </verify>
  <done>
EmptyState.tsx and ErrorState.tsx exist in src/components/feedback/ with correct shadcn component usage and CSS variable-backed colors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire skeleton, empty state, and error state into all 3 list pages</name>
  <files>
    src/pages/Teachers.tsx
    src/pages/Students.tsx
    src/pages/Orchestras.tsx
  </files>
  <action>
Wire the new feedback components into all 3 list pages by replacing the existing spinner/error/empty patterns.

**Teachers.tsx modifications:**

1. **Add imports** at the top:
   - `import { TableSkeleton } from '../components/feedback/Skeleton'`
   - `import { EmptyState } from '../components/feedback/EmptyState'`
   - `import { ErrorState } from '../components/feedback/ErrorState'`
   - `import { Users } from 'lucide-react'` (already imported — verify)

2. **Replace loading block** (around line 537-546):
   - OLD: `if (loading) { return (<div>...<Loader className="w-8 h-8 animate-spin">...טוען מורים...</div>) }`
   - NEW: `if (loading) { return (<div className="animate-fade-in"><TableSkeleton rows={8} cols={5} /></div>) }`

3. **Replace error block** (around line 548-561):
   - OLD: `if (error) { return (<div>...❌ שגיאה...button onClick={loadTeachers(1, false)}</div>) }`
   - NEW: `if (error) { return (<ErrorState message={error} onRetry={() => loadTeachers(1, false)} />) }`

4. **Replace empty state** (around line 825-829):
   - OLD: `{filteredTeachers.length === 0 && !loading && !searchLoading && (<div>לא נמצאו מורים...</div>)}`
   - NEW: Differentiate between "no results from search" and "no data at all":
     ```
     {filteredTeachers.length === 0 && !loading && !searchLoading && (
       searchTerm || filters.instrument || filters.role ? (
         <div className="text-center py-12 text-muted-foreground">לא נמצאו מורים התואמים לחיפוש</div>
       ) : (
         <EmptyState
           title="אין מורים עדיין"
           description="הוסף מורים לקונסרבטוריון כדי להתחיל"
           icon={<Users className="w-12 h-12" />}
           action={{ label: 'הוסף מורה', onClick: () => setShowAddTeacherModal(true) }}
         />
       )
     )}
     ```

5. **Remove Loader from imports** if it's no longer used anywhere in the file. Check: if `Loader` is only used in the loading/loadingMore sections, and loadingMore still uses it, keep the import but remove from the loading block.

**Students.tsx modifications:**

1. **Add imports**: Same 3 imports as Teachers (TableSkeleton, EmptyState, ErrorState). Import `GraduationCap` from lucide-react for the empty state icon.

2. **Replace loading block** (around line 795-804):
   - NEW: `if (loading) { return (<div className="animate-fade-in"><TableSkeleton rows={8} cols={6} /></div>) }`
   - Note: Students table has more columns (checkbox?, name, instrument, teacher, orchestra, grade, status, actions) — use `cols={6}`.

3. **Replace error block** (around line 806-815):
   - NEW: `if (error) { return (<ErrorState message={error} onRetry={loadStudents} />) }`

4. **Replace empty state** (around line 1129-1133):
   - NEW: Same pattern as Teachers — differentiate search vs no data.
   - Empty state: `title="אין תלמידים עדיין"`, `description="הוסף תלמידים לקונסרבטוריון"`, icon `<GraduationCap className="w-12 h-12" />`, action `{ label: 'הוסף תלמיד', onClick: () => setShowForm(true) }`.
   - Search empty: keep `"לא נמצאו תלמידים התואמים לחיפוש"` with `text-muted-foreground`.

**Orchestras.tsx modifications:**

1. **Add imports**: Same 3 imports. Use `Music` icon for empty state (already imported).

2. **Replace loading block** (around line 254-263):
   - OLD: `if (loading) { return (<div>...<div className="animate-spin rounded-full h-8 w-8 border-b-2">...טוען תזמורות...</div>) }`
   - NEW: `if (loading) { return (<div className="animate-fade-in"><TableSkeleton rows={6} cols={4} /></div>) }`

3. **Add error state** — Orchestras currently shows error as an inline banner (line 279-283) INSIDE the main return, not as a full-page return. Change it:
   - Keep the inline error banner as-is for non-blocking errors (e.g., delete failure).
   - BUT: add a full-page ErrorState as an early return if `error && orchestras.length === 0` (initial load failure):
     ```
     if (error && orchestras.length === 0) {
       return <ErrorState message={error} onRetry={loadData} />
     }
     ```
   - Place this AFTER the `if (loading)` block and BEFORE the main return.

4. **Add empty state** — Orchestras doesn't currently have a visible empty state for zero orchestras. Look for where orchestras are rendered (table/grid/dashboard views) and add:
   - If `filteredOrchestras.length === 0 && !loading`, show EmptyState: `title="אין תזמורות עדיין"`, `description="צור תזמורת חדשה כדי להתחיל"`, icon `<Music className="w-12 h-12" />`, action `{ label: 'תזמורת חדשה', onClick: handleCreateOrchestra }`.

**Important notes:**
- Use `animate-fade-in` class on skeleton wrappers (already exists in tailwind.config.js) for smooth appearance.
- Do NOT remove the `Loader` import from files that still use it for "load more" buttons — only remove from the initial loading block.
- Use `text-muted-foreground` (CSS var) instead of `text-gray-500` for search-no-results text.
  </action>
  <verify>
For each of the 3 files:
1. Grep for `animate-spin` — should NOT appear in the initial loading block (may still appear in "load more" buttons)
2. Grep for `TableSkeleton` — should appear in the loading block
3. Grep for `EmptyState` — should appear in the empty data block
4. Grep for `ErrorState` — should appear in the error block
5. Grep for `❌` — should NOT appear (emoji error indicators removed)
  </verify>
  <done>
All 3 list pages (Teachers, Students, Orchestras) show:
- TableSkeleton during loading (no spinner)
- EmptyState with Hebrew CTA when no data
- ErrorState with retry button on error
- Search-specific "no results" text when filters return empty
  </done>
</task>

</tasks>

<verification>
1. Teachers.tsx: `grep 'TableSkeleton\|EmptyState\|ErrorState' src/pages/Teachers.tsx` — all 3 present
2. Students.tsx: `grep 'TableSkeleton\|EmptyState\|ErrorState' src/pages/Students.tsx` — all 3 present
3. Orchestras.tsx: `grep 'TableSkeleton\|EmptyState\|ErrorState' src/pages/Orchestras.tsx` — all 3 present
4. No spinner in initial loading: `grep -n 'animate-spin' src/pages/Teachers.tsx src/pages/Students.tsx src/pages/Orchestras.tsx` — only in "load more" buttons, not in the `if (loading)` blocks
5. No emoji error: `grep '❌' src/pages/Teachers.tsx src/pages/Students.tsx` — zero results
6. EmptyState uses shadcn Button: `grep 'Button' src/components/feedback/EmptyState.tsx` — present
</verification>

<success_criteria>
- Loading any list page shows table-shaped skeleton rows, not a spinner
- An empty Teachers table shows "אין מורים עדיין" with "הוסף מורה" button
- A network error shows "שגיאה בטעינת הנתונים" with "נסה שוב" retry button
- Search returning 0 results shows "לא נמצאו ... התואמים לחיפוש" (not the empty state with CTA)
</success_criteria>

<output>
After completion, create `.planning/phases/08-domain-components-loading-states/08-02-SUMMARY.md`
</output>
