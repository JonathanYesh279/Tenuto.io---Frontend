---
phase: 12-layout-dashboard
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/Dashboard.tsx
  - src/components/ui/StatsCard.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard header shows a personalized time-aware Hebrew greeting (e.g. 'בוקר טוב, יונה') using user.personalInfo.firstName from auth context"
    - "Orchestra StatsCard uses color='teal' instead of 'purple' — warm palette only"
    - "StatsCard title and subtitle text use design token colors — not hardcoded text-gray-600/text-gray-500"
    - "Dashboard tab navigation uses design token colors — not hardcoded bg-white/border-gray-200"
    - "Dashboard activity feed and events sections use design token text colors — not hardcoded text-gray-900/text-gray-600"
    - "Refresh button uses design tokens — not hardcoded bg-white/border-gray-200"
  artifacts:
    - path: "src/pages/Dashboard.tsx"
      provides: "Personalized greeting + warm design token colors throughout"
      contains: "getTimeGreeting"
    - path: "src/components/ui/StatsCard.tsx"
      provides: "StatsCard with design token text colors"
      contains: "text-muted-foreground"
  key_links:
    - from: "src/pages/Dashboard.tsx"
      to: "authContext user.personalInfo.firstName"
      via: "useAuth hook"
      pattern: "personalInfo\\.firstName"
    - from: "src/pages/Dashboard.tsx"
      to: "getDisplayName from nameUtils"
      via: "import already exists"
      pattern: "getDisplayName"
---

<objective>
Add a personalized time-aware Hebrew greeting to the admin dashboard header, update StatsCard color props for warm palette consistency, and apply design token colors throughout the dashboard's UI elements (tabs, cards, activity feed, events, refresh button).

Purpose: The dashboard is the landing page — the first screen that sets the tone. A personalized greeting and warm token colors transform it from a generic admin panel into a welcoming music school hub. Combined with Plan 12-01's layout shell changes, this completes the visual cohesion of the entire application.

Output: Dashboard with "בוקר טוב, [name]" greeting, warm-palette stat cards, and design token colors throughout.
</objective>

<execution_context>
@/home/yona279/.claude/get-shit-done/workflows/execute-plan.md
@/home/yona279/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-layout-dashboard/12-RESEARCH.md
@src/pages/Dashboard.tsx
@src/components/ui/StatsCard.tsx
@src/services/authContext.jsx (for user.personalInfo.firstName path)
@src/utils/nameUtils.ts (for getDisplayName)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add personalized greeting and apply design tokens to Dashboard</name>
  <files>src/pages/Dashboard.tsx</files>
  <action>
**Step 1: Add getTimeGreeting helper function**

Add this helper inside the Dashboard component (before the return statement, after the `userRole` declaration around line 251):

```tsx
const getTimeGreeting = (): string => {
  const hour = new Date().getHours()
  if (hour >= 5 && hour < 12) return 'בוקר טוב'
  if (hour >= 12 && hour < 17) return 'צהריים טובים'
  if (hour >= 17 && hour < 21) return 'ערב טוב'
  return 'לילה טוב'
}

const userFirstName = user?.personalInfo?.firstName
  || getDisplayName(user?.personalInfo)?.split(' ')[0]
  || 'מנהל'
```

Note: `getDisplayName` is already imported on line 8. `user` is already available from `useAuth()` on line 37.

**Step 2: Replace static header with personalized greeting**

Replace the existing dashboard header section (around line 283-299):

Old:
```tsx
<h1 className="text-2xl font-bold text-gray-900">לוח בקרה</h1>
<p className="text-sm text-gray-600">
  {currentSchoolYear?.name || 'שנת לימודים נוכחית'} |
  עדכון אחרון: {lastRefresh.toLocaleTimeString('he-IL')}
</p>
```

New:
```tsx
<h1 className="text-2xl font-bold text-foreground">
  {getTimeGreeting()}, {userFirstName}
</h1>
<p className="text-sm text-muted-foreground">
  {currentSchoolYear?.name || 'שנת לימודים נוכחית'} |
  עדכון אחרון: {lastRefresh.toLocaleTimeString('he-IL')}
</p>
```

**Step 3: Update refresh button design tokens**

Change the refresh button from:
```
bg-white border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50
```
to:
```
bg-card border border-border rounded-lg hover:bg-muted disabled:opacity-50
```

**Step 4: Update tab navigation design tokens**

Change the tab container from:
```
bg-white border border-gray-200 rounded-lg mb-6 p-1
```
to:
```
bg-card border border-border rounded-lg mb-6 p-1
```

Change the active tab from `bg-primary-50 text-primary-700` to `bg-primary/10 text-primary` (uses the CSS token primary, not the palette class primary-50/primary-700).

Change the inactive tab from `text-gray-600 hover:text-gray-900 hover:bg-gray-50` to `text-muted-foreground hover:text-foreground hover:bg-muted`.

**Step 5: Update StatsCard color props**

Change the orchestras card from `color="purple"` to `color="teal"`. This removes the only non-warm color from the dashboard. All other color props are already warm:
- Students: "blue" (renders as coral via primary token) — keep
- Teachers: "green" — keep
- Orchestras: "purple" → **"teal"**
- Rehearsals: "orange" — keep
- Theory: "teal" — keep
- Bagruts: "amber" — keep

**Step 6: Update activity feed design tokens**

In the activity feed section (around lines 400-432):
- Card section title: `text-gray-900` → `text-foreground`
- "צפה בהכל" link: `text-primary-600 hover:text-primary-700` → `text-primary hover:text-primary/80`
- Loading/empty text: `text-gray-500` → `text-muted-foreground`
- Activity title: `text-gray-900` → `text-foreground`
- Activity description: `text-gray-600` → `text-muted-foreground`
- Activity time: `text-gray-500` → `text-muted-foreground`
- Activity dot colors: `bg-blue-500` → `bg-primary`, `bg-green-500` → `bg-success-500`, `bg-orange-500` → `bg-accent`

**Step 7: Update upcoming events design tokens**

In the events section (around lines 434-467):
- Section title: `text-gray-900` → `text-foreground`
- Loading/empty text: `text-gray-500` → `text-muted-foreground`
- Non-primary event bg: `bg-gray-50` → `bg-muted/50`
- Non-primary event title: `text-gray-900` → `text-foreground`
- Non-primary event date/desc: `text-gray-500` / `text-gray-600` → `text-muted-foreground`
- Primary event styles: `bg-primary-50 border border-primary-100` → `bg-primary/10 border border-primary/20`, and `text-primary-900` → `text-primary`, `text-primary-600` → `text-primary/80`, `text-primary-700` → `text-primary/90`

**Step 8: Update schedule tab design tokens**

In the schedule tab section (around lines 480-500):
- Weekly summary card title: `text-gray-900` → `text-foreground`
- `bg-blue-50` → `bg-primary/10`, `text-blue-600` → `text-primary`, `text-gray-700` → `text-foreground/80`

**Important notes:**
- Do NOT change the role-based dashboard routing logic (SuperAdmin, Teacher, Conductor, Theory-Teacher dashboards)
- Do NOT change the data loading logic (Promise.allSettled, stats calculations)
- Do NOT change the chart components (StudentActivityCharts, InstrumentDistributionChart, etc.) — they are separate components
- Do NOT change the Hours tab section — it was built recently and may have different patterns
  </action>
  <verify>
Run `grep "getTimeGreeting" src/pages/Dashboard.tsx` — confirms greeting function exists.
Run `grep "personalInfo.*firstName" src/pages/Dashboard.tsx` — confirms correct user name path.
Run `grep 'color="purple"' src/pages/Dashboard.tsx` — should return empty (changed to teal).
Run `grep "text-gray-900" src/pages/Dashboard.tsx | head -5` — should show significantly fewer matches (some may remain in Hours tab or chart sections not targeted).
  </verify>
  <done>
Dashboard header shows personalized time-aware Hebrew greeting using user.personalInfo.firstName. Orchestra stat card uses teal instead of purple. Tab navigation, refresh button, activity feed, events section, and schedule tab all use design token colors (text-foreground, text-muted-foreground, bg-card, bg-muted, bg-primary/N) instead of hardcoded gray/primary-N palette classes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update StatsCard component to use design token text colors</name>
  <files>src/components/ui/StatsCard.tsx</files>
  <action>
The StatsCard component currently uses hardcoded gray text for the title and subtitle. Update these to design tokens for consistency:

1. **Title text:** Change `text-gray-600` to `text-muted-foreground` (line 79: `<h3 className="text-sm font-medium text-gray-600 mb-1">`)

2. **Subtitle text:** Change `text-gray-500` to `text-muted-foreground` (line 94: `<p className="text-sm text-gray-500">`)

3. **Trend label text:** Change `text-gray-400` to `text-muted-foreground/70` (line 98: `<p className="text-xs text-gray-400 mt-1">`)

4. **Trend down color:** Change `text-red-600` to `text-destructive` (line 88) — uses CSS token.

These are minor token alignment changes. Do NOT change the color mapping object (colorClasses) — those specific bg-primary-100/text-primary-600 classes are intentionally mapped to the Tailwind palette scales for variety.
  </action>
  <verify>
Run `grep "text-gray" src/components/ui/StatsCard.tsx` — should return empty (all replaced with token classes).
Run `grep "text-muted-foreground" src/components/ui/StatsCard.tsx` — should return 3 matches (title, subtitle, trend label).
  </verify>
  <done>
StatsCard title, subtitle, and trend label use design token text colors (text-muted-foreground) instead of hardcoded gray. Trend down direction uses text-destructive token. Color mapping object unchanged — maintains variety through palette-scale classes.
  </done>
</task>

</tasks>

<verification>
1. `grep "getTimeGreeting" src/pages/Dashboard.tsx` — returns function definition and usage
2. `grep "personalInfo.*firstName" src/pages/Dashboard.tsx` — returns correct user name path
3. `grep 'color="purple"' src/pages/Dashboard.tsx` — returns empty (changed to teal)
4. `grep "text-gray" src/components/ui/StatsCard.tsx` — returns empty (all tokens)
5. `grep "bg-card" src/pages/Dashboard.tsx` — returns matches for tab container and refresh button
6. `grep "text-foreground" src/pages/Dashboard.tsx` — returns matches confirming token usage
</verification>

<success_criteria>
- Dashboard shows "בוקר טוב, [firstName]" (or appropriate time greeting) — not static "לוח בקרה"
- User name comes from user.personalInfo.firstName — not user.firstName (which would be undefined)
- Orchestra StatsCard uses warm color (teal) — no purple in dashboard
- StatsCard text uses design tokens — no hardcoded gray text
- Dashboard tabs, refresh button, activity feed, and events use design tokens — visual consistency with all other redesigned pages
</success_criteria>

<output>
After completion, create `.planning/phases/12-layout-dashboard/12-02-SUMMARY.md`
</output>
