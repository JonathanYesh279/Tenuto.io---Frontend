---
phase: 06-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - index.html
  - src/main.tsx
  - src/index.css
  - tailwind.config.js
  - components.json
autonomous: true

must_haves:
  truths:
    - "CSS custom properties for all shadcn semantic tokens (primary, background, foreground, card, popover, muted, accent, destructive, border, input, ring, sidebar) are defined in :root"
    - "Tailwind config maps semantic tokens via hsl(var(--token)) alongside existing color scales — bg-primary-500 still resolves, bg-primary resolves to CSS variable"
    - "DirectionProvider wraps the app and document.documentElement has dir=rtl and lang=he"
    - "Heebo font loads via Google Fonts with preconnect hints and is first in Tailwind fontFamily.sans stack"
    - "components.json exists at project root with correct Vite project settings for shadcn CLI"
    - "npm run build succeeds with zero new errors"
  artifacts:
    - path: "components.json"
      provides: "shadcn CLI compatibility config"
      contains: "ui.shadcn.com/schema.json"
    - path: "src/index.css"
      provides: "CSS custom property token layer"
      contains: "--primary:"
    - path: "tailwind.config.js"
      provides: "Semantic token mapping merged with existing scales"
      contains: "hsl(var(--primary))"
    - path: "src/main.tsx"
      provides: "RTL dir attribute + DirectionProvider wrapper"
      contains: "DirectionProvider"
    - path: "index.html"
      provides: "lang=he, dir=rtl, Heebo font preconnect"
      contains: "lang=\"he\""
  key_links:
    - from: "src/index.css"
      to: "tailwind.config.js"
      via: "CSS variables consumed by hsl(var(--token)) in Tailwind colors"
      pattern: "--primary.*hsl\\(var\\(--primary\\)\\)"
    - from: "src/main.tsx"
      to: "@radix-ui/react-direction"
      via: "DirectionProvider import wrapping app tree"
      pattern: "DirectionProvider"
    - from: "index.html"
      to: "fonts.googleapis.com"
      via: "Heebo font stylesheet link with preconnect"
      pattern: "Heebo"
---

<objective>
Install the complete CSS design token infrastructure, Radix RTL DirectionProvider, Heebo font, and shadcn CLI config — establishing the foundation that all subsequent v2.0 phases build on.

Purpose: shadcn/ui components currently reference semantic tokens (bg-primary, text-foreground, etc.) that resolve to nothing because CSS custom properties are not defined. This plan installs the token bridge so components render correctly. It also fixes RTL portal behavior for Radix components and establishes the typography stack.

Output: Working token system in :root, Tailwind config with merged semantic + scale colors, DirectionProvider wrapping app, Heebo font loading, components.json for shadcn CLI.
</objective>

<execution_context>
@/home/yona279/.claude/get-shit-done/workflows/execute-plan.md
@/home/yona279/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-foundation/06-RESEARCH.md

Key source files:
@tailwind.config.js
@src/index.css
@src/main.tsx
@index.html
@src/lib/utils.ts
@src/components/ui/button.tsx (example of shadcn component using semantic tokens)
@src/components/ui/select.tsx (example of Radix portal component)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install DirectionProvider, update index.html and main.tsx, create components.json</name>
  <files>
    package.json
    index.html
    src/main.tsx
    components.json
  </files>
  <action>
**Step 1: Install @radix-ui/react-direction**

Run `npm install @radix-ui/react-direction` from the project root.

**Step 2: Update index.html**

Change `<html lang="en">` to `<html lang="he" dir="rtl">`.

Add Heebo font preconnect hints and stylesheet link in `<head>`, BEFORE the closing `</head>`:
```html
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
```

**Step 3: Update src/main.tsx**

Add before `ReactDOM.createRoot`:
```tsx
document.documentElement.setAttribute('dir', 'rtl');
document.documentElement.setAttribute('lang', 'he');
```

Import `DirectionProvider` from `@radix-ui/react-direction` and wrap the app tree. The final render should be:
```tsx
import { DirectionProvider } from '@radix-ui/react-direction';

// ... existing code ...

ReactDOM.createRoot(rootElement).render(
  <React.StrictMode>
    <QueryClientProvider client={queryClient}>
      <DirectionProvider dir="rtl">
        <BrowserRouter
          future={{
            v7_startTransition: true,
            v7_relativeSplatPath: true,
          }}
        >
          <App />
        </BrowserRouter>
      </DirectionProvider>
    </QueryClientProvider>
  </React.StrictMode>
)
```

Note: The `document.documentElement.setAttribute` calls are technically redundant since `index.html` now has `dir="rtl" lang="he"` — but keeping both ensures SSR-like scenarios or dynamic HTML injection still work. The DirectionProvider is the critical piece for Radix portals.

**Step 4: Create components.json**

Create `components.json` at project root with:
```json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.js",
    "css": "src/index.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}
```
  </action>
  <verify>
1. `npm ls @radix-ui/react-direction` shows the package is installed
2. `grep -n 'lang="he"' index.html` shows the lang attribute
3. `grep -n 'dir="rtl"' index.html` shows the dir attribute
4. `grep -n 'Heebo' index.html` shows the font link
5. `grep -n 'DirectionProvider' src/main.tsx` shows the import and usage
6. `cat components.json | head -5` shows the schema reference
7. `npm run build` succeeds (no new errors)
  </verify>
  <done>
index.html has lang="he" dir="rtl" and Heebo font preconnect. main.tsx sets dir/lang attributes and wraps app in DirectionProvider. components.json exists at project root. @radix-ui/react-direction is installed. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add CSS token layer to index.css and merge semantic tokens into tailwind.config.js</name>
  <files>
    src/index.css
    tailwind.config.js
  </files>
  <action>
**Step 1: Add CSS custom properties to src/index.css**

Add an `@layer base` block with `:root` token definitions AFTER the existing `@import` statements but BEFORE the existing CSS reset rules. Place it right after the last `@import` line (line 16: `@import url(... Inter ...)`).

Use HSL channel values (H S% L%) WITHOUT the `hsl()` wrapper — the wrapper goes in `tailwind.config.js`.

The token values for Phase 6 map to the EXISTING color palette (current blue theme) for zero visual change. The coral palette values will be installed in a later phase. Token names are permanent; only values change later.

```css
/* === Design Token System (Phase 6: Foundation) === */
/* Token values currently map to existing blue palette for zero visual change. */
/* Values will be swapped to coral/warm palette in Phase 7+. */
@layer base {
  :root {
    --background: 210 20% 98%;
    --foreground: 222 47% 11%;
    --card: 0 0% 100%;
    --card-foreground: 222 47% 11%;
    --popover: 0 0% 100%;
    --popover-foreground: 222 47% 11%;
    --primary: 245 58% 51%;
    --primary-foreground: 0 0% 100%;
    --secondary: 215 16% 47%;
    --secondary-foreground: 0 0% 100%;
    --muted: 220 14% 96%;
    --muted-foreground: 220 9% 46%;
    --accent: 217 91% 95%;
    --accent-foreground: 224 64% 33%;
    --destructive: 0 72% 51%;
    --destructive-foreground: 0 0% 100%;
    --border: 220 13% 91%;
    --input: 220 13% 91%;
    --ring: 245 58% 51%;
    --radius: 0.5rem;
    --sidebar: 217 33% 17%;
    --sidebar-foreground: 210 20% 98%;
  }
}
```

Also, remove the `@import url(... Inter ...)` line (line 18 in current file: `@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');`). Heebo replaces Inter, and loading happens via `<link>` in `index.html` now (better for performance — no render-blocking @import).

Keep the Reisinger Yonatan @font-face declaration — it stays as fallback for Phase 6 (zero visible change). It will be removed in Phase 7+.

**Step 2: Update tailwind.config.js**

This is the most critical step. The existing `primary` and `secondary` color objects have numbered scales (50-950). We must MERGE the new `DEFAULT` and `foreground` keys INTO the existing objects, NOT replace them. If we replace, all existing `bg-primary-500` classes break.

Update the `colors` section inside `theme.extend` to add semantic tokens:

```javascript
colors: {
  // === Semantic tokens (CSS variable backed, for shadcn/ui components) ===
  background: "hsl(var(--background))",
  foreground: "hsl(var(--foreground))",
  border: "hsl(var(--border))",
  input: "hsl(var(--input))",
  ring: "hsl(var(--ring))",
  card: {
    DEFAULT: "hsl(var(--card))",
    foreground: "hsl(var(--card-foreground))",
  },
  popover: {
    DEFAULT: "hsl(var(--popover))",
    foreground: "hsl(var(--popover-foreground))",
  },
  muted: {
    DEFAULT: "hsl(var(--muted))",
    foreground: "hsl(var(--muted-foreground))",
  },
  accent: {
    DEFAULT: "hsl(var(--accent))",
    foreground: "hsl(var(--accent-foreground))",
  },
  destructive: {
    DEFAULT: "hsl(var(--destructive))",
    foreground: "hsl(var(--destructive-foreground))",
  },
  sidebar: {
    DEFAULT: "hsl(var(--sidebar))",
    foreground: "hsl(var(--sidebar-foreground))",
  },
  // === Existing palettes with semantic tokens MERGED in ===
  primary: {
    50: '#eff6ff',
    100: '#dbeafe',
    200: '#bfdbfe',
    300: '#93c5fd',
    400: '#60a5fa',
    500: '#4F46E5',
    600: '#3b82f6',
    700: '#1d4ed8',
    800: '#1e40af',
    900: '#1e3a8a',
    950: '#172554',
    DEFAULT: "hsl(var(--primary))",
    foreground: "hsl(var(--primary-foreground))",
  },
  secondary: {
    50: '#f8fafc',
    100: '#f1f5f9',
    200: '#e2e8f0',
    300: '#cbd5e1',
    400: '#94a3b8',
    500: '#64748b',
    600: '#475569',
    700: '#334155',
    800: '#1e293b',
    900: '#0f172a',
    950: '#020617',
    DEFAULT: "hsl(var(--secondary))",
    foreground: "hsl(var(--secondary-foreground))",
  },
  // === Existing palettes (unchanged) ===
  success: { /* keep existing success scale exactly as-is */ },
  orange: { /* keep existing orange scale exactly as-is */ },
  purple: { /* keep existing purple scale exactly as-is */ },
  gray: { /* keep existing gray scale exactly as-is */ },
},
```

IMPORTANT: Keep the success, orange, purple, and gray scales EXACTLY as they currently are. Only add to primary and secondary, and add the new semantic token keys (background, foreground, border, etc.).

Also update `borderRadius` to add CSS variable driven values alongside existing:
```javascript
borderRadius: {
  lg: "var(--radius)",
  md: "calc(var(--radius) - 2px)",
  sm: "calc(var(--radius) - 4px)",
  '4xl': '2rem',
},
```

Update `fontFamily` to put Heebo first in the sans stack, keeping Reisinger as fallback:
```javascript
fontFamily: {
  sans: [
    'Heebo',
    'Reisinger Yonatan',
    'Arial Hebrew',
    'system-ui',
    '-apple-system',
    'BlinkMacSystemFont',
    'sans-serif'
  ],
  hebrew: ['Heebo', 'Arial Hebrew', 'Noto Sans Hebrew', 'sans-serif'],
  music: ['Bravura', 'Dorico', 'MuseScore', 'Finale', 'serif'],
  'reisinger-yonatan': [
    'Reisinger Yonatan',
    'Arial Hebrew',
    'Noto Sans Hebrew',
    'Arial',
    'sans-serif'
  ],
  'reisinger-neta': [
    'Reisinger Neta',
    'Arial Hebrew',
    'Noto Sans Hebrew',
    'Arial',
    'sans-serif'
  ]
},
```

Remove `'Inter'` and `'Segoe UI'` and `'Roboto'` from the sans stack — they are not needed with Heebo.
  </action>
  <verify>
1. `grep '\-\-primary:' src/index.css` confirms CSS custom properties exist
2. `grep 'hsl(var(--primary))' tailwind.config.js` confirms Tailwind mapping
3. `grep "'500'" tailwind.config.js` confirms existing scale values are preserved
4. `grep 'Heebo' tailwind.config.js` confirms Heebo is in font stack
5. `grep 'var(--radius)' tailwind.config.js` confirms borderRadius tokens
6. `npm run build` succeeds with zero errors
7. Verify no `@import.*Inter` remains in src/index.css
  </verify>
  <done>
CSS custom properties defined in :root via @layer base in index.css. Tailwind config merges semantic tokens (DEFAULT, foreground) into existing primary/secondary scales without breaking bg-primary-500 class resolution. New semantic keys (background, foreground, border, etc.) added. Heebo is first in font stack. borderRadius uses CSS variable. Build passes.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes — zero new errors from token system, DirectionProvider, or config changes
2. All existing Tailwind classes (`bg-primary-500`, `text-secondary-600`, `border-gray-200`) still resolve correctly
3. New semantic classes (`bg-primary`, `text-foreground`, `bg-background`, `bg-destructive`) now resolve to CSS variable values
4. `@radix-ui/react-direction` is in package.json dependencies
5. `components.json` exists and passes JSON parse
6. `index.html` has `lang="he" dir="rtl"` and Heebo font links
</verification>

<success_criteria>
- CSS custom properties exist in :root with HSL channel values for all shadcn semantic tokens
- Tailwind config has both numbered scales (50-950) AND semantic DEFAULT/foreground for primary and secondary
- DirectionProvider wraps the entire app tree in main.tsx
- Heebo font loads via link tags in index.html with preconnect hints
- components.json exists at project root for shadcn CLI
- npm run build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-foundation/06-01-SUMMARY.md`
</output>
