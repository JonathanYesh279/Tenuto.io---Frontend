---
phase: 07-primitives
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tailwind.config.js
  - src/components/ui/dialog.tsx
  - src/components/ui/tabs.tsx
  - src/components/ui/dropdown-menu.tsx
  - src/components/ui/tooltip.tsx
  - src/components/ui/avatar.tsx
  - src/components/ui/switch.tsx
  - src/components/ui/checkbox.tsx
  - src/components/ui/separator.tsx
  - src/components/ui/progress.tsx
  - src/components/ui/badge.tsx
  - src/components/ui/ConfirmDeleteDialog.tsx
  - src/components/ui/Modal.tsx
  - src/components/Header.tsx
autonomous: true

must_haves:
  truths:
    - "shadcn Dialog component renders with entrance/exit animation (animate-in/animate-out)"
    - "shadcn Tabs component is available and renders with RTL tab ordering"
    - "ConfirmDeleteDialog shows Hebrew confirmation text, optional cascade consequences list, and a red destructive button"
    - "Header profile dropdown uses shadcn DropdownMenu instead of manual ref/clickOutside"
    - "Badge component has active/inactive/graduated/pending status variants"
    - "All interactive shadcn components have visible focus-visible:ring-2 for keyboard navigation"
  artifacts:
    - path: "src/components/ui/dialog.tsx"
      provides: "shadcn Dialog primitive"
    - path: "src/components/ui/tabs.tsx"
      provides: "shadcn Tabs primitive"
    - path: "src/components/ui/dropdown-menu.tsx"
      provides: "shadcn DropdownMenu primitive"
    - path: "src/components/ui/tooltip.tsx"
      provides: "shadcn Tooltip primitive"
    - path: "src/components/ui/avatar.tsx"
      provides: "shadcn Avatar primitive"
    - path: "src/components/ui/switch.tsx"
      provides: "shadcn Switch primitive"
    - path: "src/components/ui/checkbox.tsx"
      provides: "shadcn Checkbox primitive"
    - path: "src/components/ui/separator.tsx"
      provides: "shadcn Separator primitive"
    - path: "src/components/ui/ConfirmDeleteDialog.tsx"
      provides: "Delete confirmation dialog built on shadcn Dialog"
    - path: "src/components/ui/badge.tsx"
      provides: "Badge with active/inactive/graduated/pending variants"
  key_links:
    - from: "tailwind.config.js"
      to: "tailwindcss-animate"
      via: "plugins array require()"
      pattern: "require\\('tailwindcss-animate'\\)"
    - from: "src/components/ui/ConfirmDeleteDialog.tsx"
      to: "src/components/ui/dialog.tsx"
      via: "import Dialog components"
      pattern: "from.*dialog"
    - from: "src/components/Header.tsx"
      to: "src/components/ui/dropdown-menu.tsx"
      via: "import DropdownMenu components"
      pattern: "from.*dropdown-menu"
---

<objective>
Install all missing Radix UI packages, generate shadcn/ui primitive component files (Dialog, Tabs, DropdownMenu, Tooltip, Avatar, Switch, Checkbox, Separator, Progress), build the ConfirmDeleteDialog domain component, extend Badge with status variants, update Modal.tsx to wrap shadcn Dialog, and migrate the Header profile dropdown to shadcn DropdownMenu.

Purpose: Establish the complete shadcn primitive layer so Plan 07-02 can migrate all callsites without installing anything new.
Output: 9 shadcn primitives, 1 ConfirmDeleteDialog, 1 updated Modal wrapper, 1 updated Badge, 1 migrated Header.
</objective>

<execution_context>
@/home/yona279/.claude/get-shit-done/workflows/execute-plan.md
@/home/yona279/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-primitives/07-RESEARCH.md

Source files to read before editing:
@tailwind.config.js
@components.json
@src/components/ui/Modal.tsx
@src/components/ui/badge.tsx
@src/components/ui/button.tsx
@src/components/Header.tsx
@src/components/ui/ConfirmDeleteModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install tailwindcss-animate + Radix packages, generate shadcn primitives</name>
  <files>
    package.json
    tailwind.config.js
    src/components/ui/dialog.tsx
    src/components/ui/tabs.tsx
    src/components/ui/dropdown-menu.tsx
    src/components/ui/tooltip.tsx
    src/components/ui/avatar.tsx
    src/components/ui/switch.tsx
    src/components/ui/checkbox.tsx
    src/components/ui/separator.tsx
    src/components/ui/progress.tsx
  </files>
  <action>
    **Step 1: Install tailwindcss-animate (MUST be first)**
    ```bash
    npm install tailwindcss-animate
    ```

    **Step 2: Register the plugin in tailwind.config.js**
    Add `require('tailwindcss-animate')` as the FIRST entry in the `plugins` array (before the existing RTL support plugin function). This enables `data-[state=open]:animate-in`, `data-[state=closed]:animate-out`, and related animation utility classes that every shadcn animated component depends on.

    The plugins array should look like:
    ```javascript
    plugins: [
      require('tailwindcss-animate'),
      function({ addUtilities, addComponents, theme }) {
        // existing RTL support plugin stays unchanged
      },
    ],
    ```

    **Step 3: Generate all shadcn primitive components using the CLI**
    Run in a single command (the CLI installs missing Radix peer deps automatically):
    ```bash
    npx shadcn@latest add dialog tabs dropdown-menu tooltip avatar switch checkbox separator progress --overwrite
    ```
    Use `--overwrite` because `progress.tsx` already exists as a custom component. The CLI version uses `bg-primary` (CSS var backed) which is correct with our token system.

    **Step 4: Verify the generated files exist and compile**
    Run `npm run build` (or at minimum `npx tsc --noEmit`) to confirm no TypeScript errors in the new component files.

    **Important notes:**
    - Do NOT run `npx shadcn@latest migrate rtl` — the app already has full RTL via DirectionProvider.
    - The `components.json` already points to `@/components/ui` so files land in the correct directory.
    - If the CLI prompts about overwriting progress.tsx, accept it.
  </action>
  <verify>
    1. `ls src/components/ui/dialog.tsx src/components/ui/tabs.tsx src/components/ui/dropdown-menu.tsx src/components/ui/tooltip.tsx src/components/ui/avatar.tsx src/components/ui/switch.tsx src/components/ui/checkbox.tsx src/components/ui/separator.tsx src/components/ui/progress.tsx` — all 9 files exist
    2. `grep "tailwindcss-animate" tailwind.config.js` — plugin registered
    3. `grep "tailwindcss-animate" package.json` — package installed
    4. `npm run build` passes without errors
  </verify>
  <done>
    9 shadcn/ui primitive component files exist in src/components/ui/. tailwindcss-animate is installed and registered as a Tailwind plugin. The project builds without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build ConfirmDeleteDialog, update Modal wrapper, extend Badge, migrate Header dropdown</name>
  <files>
    src/components/ui/ConfirmDeleteDialog.tsx
    src/components/ui/Modal.tsx
    src/components/ui/badge.tsx
    src/components/Header.tsx
  </files>
  <action>
    **A. Create ConfirmDeleteDialog (new file)**

    Create `src/components/ui/ConfirmDeleteDialog.tsx` — a domain-specific delete confirmation dialog built on shadcn Dialog. This replaces all 4 custom modal variants for delete confirmations.

    Props interface:
    ```typescript
    interface ConfirmDeleteDialogProps {
      open: boolean
      onOpenChange: (open: boolean) => void
      title?: string              // default: 'אישור מחיקה'
      description?: string        // main message text
      itemName?: string           // name of item being deleted (shown bold)
      consequences?: string[]     // optional cascade consequence list
      confirmText?: string        // default: 'מחק'
      cancelText?: string         // default: 'ביטול'
      onConfirm: () => void
      isLoading?: boolean
      variant?: 'danger' | 'warning' | 'info'  // default: 'danger'
    }
    ```

    Implementation requirements:
    - Use `Dialog`, `DialogContent`, `DialogHeader`, `DialogTitle`, `DialogDescription`, `DialogFooter` from `@/components/ui/dialog`
    - Use `Button` from `@/components/ui/button` (variant="destructive" for confirm, variant="outline" for cancel)
    - Show `AlertTriangle` icon from lucide-react in the header, colored by variant (red for danger, yellow for warning, blue for info)
    - If `consequences` array is provided and non-empty, render a list with destructive-colored bullets
    - If `itemName` is provided, show it in bold within the description area
    - Show "פעולה זו אינה ניתנת לביטול." as secondary text
    - DialogFooter: In RTL, the destructive button should appear first in JSX (visually on the right = prominent), cancel second. Apply `className="gap-2 sm:gap-2"` to footer.
    - When `isLoading`, show a spinner inside the confirm button and disable both buttons
    - Add `duration-200` to DialogContent className for Phase 6 animation standard (200ms modal entrance)

    **B. Update Modal.tsx to wrap shadcn Dialog**

    Rewrite `src/components/ui/Modal.tsx` to be a thin wrapper around shadcn Dialog that preserves the existing prop API (`isOpen`, `onClose`, `title`, `children`, `maxWidth`, `showCloseButton`, `closeOnBackdrop`). This allows existing callsites (5 files: ConfirmationModal, BulkTheoryUpdateTab, StudentDeletionModal, CascadeDeletionWorkflow, OrphanedReferenceCleanup, AuditLogViewer, TheoryLessons, Rehearsals) to work without changes until individually migrated.

    Implementation:
    - Import `Dialog, DialogContent, DialogHeader, DialogTitle` from `@/components/ui/dialog`
    - Map `isOpen` → `open`, `onClose` → `onOpenChange` (call onClose when Dialog sets open to false)
    - Map `maxWidth` prop to className (`max-w-sm`, `max-w-md`, etc.) on DialogContent
    - `closeOnBackdrop`: When false, pass `onInteractOutside={(e) => e.preventDefault()}` to DialogContent
    - `showCloseButton`: shadcn DialogContent includes a close button by default. If `showCloseButton=false`, add `[&>button]:hidden` to DialogContent className
    - `title`: Render inside DialogHeader > DialogTitle if provided
    - `children`: Render inside a scrollable `<div className="overflow-y-auto max-h-[calc(85vh-140px)]">`
    - Add `duration-200` for animation standard
    - Keep the old default export signature so import paths stay valid
    - `darkBackdrop` and `className` props: `className` passes through to DialogContent; `darkBackdrop` can map to overlay opacity if needed (or ignore since Dialog overlay is styled by default)

    **C. Extend badge.tsx with status variants**

    Add 4 new CVA variants to the existing `badgeVariants` in `src/components/ui/badge.tsx`:
    ```
    active: "border-transparent bg-green-100 text-green-800"
    inactive: "border-transparent bg-gray-100 text-gray-700"
    graduated: "border-transparent bg-purple-100 text-purple-800"
    pending: "border-transparent bg-orange-100 text-orange-800"
    ```
    These status variants will be used across list pages and detail pages for consistent status display.

    **D. Migrate Header.tsx to shadcn DropdownMenu**

    Replace the manual profile dropdown in `src/components/Header.tsx`:
    - Remove: `useState` for `isProfileDropdownOpen`, `useRef` for `profileDropdownRef`, `useEffect` for click-outside handler
    - Add imports: `DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuLabel, DropdownMenuSeparator, DropdownMenuTrigger` from `@/components/ui/dropdown-menu`
    - Replace the avatar `<div onClick>` with `<DropdownMenuTrigger asChild>` wrapping a `<button>` element (not a bare div — this ensures focus-visible ring works per A11Y-01)
    - Replace the conditional `isProfileDropdownOpen &&` block with `<DropdownMenuContent align="end" className="w-48">`
    - Use `<DropdownMenuLabel>` for the name/role section
    - Use `<DropdownMenuSeparator />` between label and items
    - Use `<DropdownMenuItem onClick={handleProfileClick}>` for profile link
    - Use `<DropdownMenuItem onClick={handleLogout} className="text-destructive">` for logout
    - Keep `getUserFullName()`, `getUserRole()`, `getInitials()` functions unchanged
    - The `align="end"` prop on DropdownMenuContent places the menu correctly in RTL (Radix reads DirectionProvider context)
    - Remove `style={{ direction: 'rtl' }}` from menu item buttons — DropdownMenu inherits RTL from context

    **Important:**
    - Do NOT change the Header's overall layout, sidebar logic, or SchoolYearSelector
    - Only replace the profile dropdown section (the `<div className="relative" ref={profileDropdownRef}>` block)
  </action>
  <verify>
    1. `ls src/components/ui/ConfirmDeleteDialog.tsx` — file exists
    2. `grep "DialogContent" src/components/ui/Modal.tsx` — Modal now wraps Dialog
    3. `grep "active.*bg-green-100" src/components/ui/badge.tsx` — status variants added
    4. `grep "DropdownMenu" src/components/Header.tsx` — Header uses DropdownMenu
    5. `grep -v "useRef\|profileDropdownRef\|handleClickOutside\|isProfileDropdownOpen" src/components/Header.tsx | grep -c "useState"` — manual dropdown state removed (only remaining useState should be for other purposes, if any)
    6. `npm run build` passes without errors
  </verify>
  <done>
    ConfirmDeleteDialog exists with Hebrew text, cascade list, and destructive button. Modal.tsx wraps shadcn Dialog preserving the isOpen/onClose API. Badge has active/inactive/graduated/pending variants. Header profile uses DropdownMenu with proper RTL alignment, and manual click-outside handler is removed. Build passes.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` — full project builds without errors
2. All 9 shadcn primitive files exist in src/components/ui/
3. ConfirmDeleteDialog.tsx exists and imports from dialog.tsx
4. Modal.tsx wraps DialogContent (not custom portal/backdrop)
5. badge.tsx has 4 new status variants (active, inactive, graduated, pending)
6. Header.tsx uses DropdownMenu (no manual ref/click-outside)
7. tailwindcss-animate is in package.json dependencies AND tailwind.config.js plugins
</verification>

<success_criteria>
- 9 new shadcn/ui primitive component files generated and compiling
- tailwindcss-animate installed and registered as Tailwind plugin (animation classes functional)
- ConfirmDeleteDialog built with Hebrew text, optional consequences list, destructive button
- Modal.tsx backward-compatible wrapper around shadcn Dialog (existing callsites still work)
- Badge extended with active/inactive/graduated/pending CVA variants
- Header profile dropdown uses shadcn DropdownMenu with correct RTL alignment
- Zero build errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-primitives/07-01-SUMMARY.md`
</output>
