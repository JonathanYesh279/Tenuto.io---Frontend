---
phase: 15-tech-debt-sweep
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/AuditTrail.tsx
  - src/pages/Teachers.tsx
  - src/pages/Students.tsx
  - src/features/students/details/components/StudentTabNavigation.tsx
  - src/features/teachers/details/components/TeacherTabNavigation.tsx
autonomous: true

must_haves:
  truths:
    - "AuditTrail page displays ErrorState component with retry button on network error instead of inline red div"
    - "Dashboard Schedule tab Weekly Summary uses design token classes with no hardcoded bg-purple-50, text-purple-600, text-gray-700, or bg-green-50"
    - "InstrumentBadge is wired to Teachers specialization column and Students instrument column"
    - "Mobile tab navigation <nav> elements use ps-4 pe-4 logical padding instead of px-4 physical padding"
  artifacts:
    - path: "src/pages/AuditTrail.tsx"
      provides: "ErrorState import and usage replacing inline error div"
      contains: "ErrorState"
    - path: "src/pages/Teachers.tsx"
      provides: "InstrumentBadge rendering in specialization column"
      contains: "InstrumentBadge"
    - path: "src/pages/Students.tsx"
      provides: "InstrumentBadge rendering in instrument column"
      contains: "InstrumentBadge"
    - path: "src/features/students/details/components/StudentTabNavigation.tsx"
      provides: "Logical padding on mobile nav"
      contains: "ps-4 pe-4"
    - path: "src/features/teachers/details/components/TeacherTabNavigation.tsx"
      provides: "Logical padding on mobile nav"
      contains: "ps-4 pe-4"
  key_links:
    - from: "src/pages/AuditTrail.tsx"
      to: "src/components/feedback/ErrorState.tsx"
      via: "import { ErrorState }"
      pattern: "import.*ErrorState.*feedback"
    - from: "src/pages/Teachers.tsx"
      to: "src/components/domain/InstrumentBadge.tsx"
      via: "import { InstrumentBadge }"
      pattern: "import.*InstrumentBadge.*domain"
    - from: "src/pages/Students.tsx"
      to: "src/components/domain/InstrumentBadge.tsx"
      via: "import { InstrumentBadge }"
      pattern: "import.*InstrumentBadge.*domain"
---

<objective>
Eliminate four tech debt items from v2.0: replace AuditTrail's inline error with ErrorState, verify Dashboard design tokens are clean, wire InstrumentBadge to list pages, and swap physical padding to logical RTL properties on mobile tab navigation.

Purpose: Close all remaining tech debt from the v2.0 milestone audit so the codebase is clean before shipping.
Output: Five files modified, zero new files created.
</objective>

<execution_context>
@/home/yona279/.claude/get-shit-done/workflows/execute-plan.md
@/home/yona279/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-tech-debt-sweep/15-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace AuditTrail inline error with ErrorState and verify Dashboard tokens</name>
  <files>src/pages/AuditTrail.tsx</files>
  <action>
**SC1 — AuditTrail ErrorState:**

1. Open `src/pages/AuditTrail.tsx`.
2. Add import: `import { ErrorState } from '../components/feedback/ErrorState'`
3. Find the inline error block (approximately lines 232-246) — it is a `{error && ( <div className="mb-6 p-4 bg-red-50 ...">` block containing AlertTriangle icon, error message text, and a retry button with RefreshCw icon.
4. Replace the entire `{error && (...)}` block with:
   ```tsx
   {error && (
     <ErrorState
       message={error}
       onRetry={handleRetry}
     />
   )}
   ```
5. Check whether `AlertTriangle` and `RefreshCw` are used anywhere else in AuditTrail.tsx (grep the file for each icon name). If NOT used elsewhere, remove them from the lucide-react import at the top of the file. If used elsewhere, keep them.
6. The `handleRetry` function already exists (approximately line 144) and dispatches correctly based on `activeTab`. Do NOT modify it.

**SC2 — Dashboard token verification:**

7. Run `grep -n 'bg-purple-50\|text-purple-600\|bg-green-50\|text-gray-700' src/pages/Dashboard.tsx` to confirm zero matches in the Weekly Summary section (lines ~507-527). This was already fixed in commit b159cc3 (Phase 12-02). If grep returns 0 results in the Weekly Summary area, SC2 is confirmed resolved — no code change needed. If grep DOES return results in lines 507-527, replace them with design token equivalents (bg-primary/10, text-primary, bg-muted/50, text-muted-foreground). Note: `text-gray-700` may appear in the Hours tab table headers (lines ~652-657) which is OUTSIDE SC2 scope — ignore those.
  </action>
  <verify>
1. `grep -n "ErrorState" src/pages/AuditTrail.tsx` shows import line and usage line
2. `grep -n "bg-red-50" src/pages/AuditTrail.tsx` returns 0 results (inline error removed)
3. `grep -c "AlertTriangle" src/pages/AuditTrail.tsx` returns 0 (if it was only used in the error block)
4. `grep -n "bg-purple-50\|text-purple-600\|bg-green-50" src/pages/Dashboard.tsx` returns 0 results for lines 507-527
5. TypeScript check: `npx tsc --noEmit --pretty 2>&1 | grep -i "AuditTrail"` shows no NEW errors from this change (pre-existing errors at lines 671/684 are expected and unrelated)
  </verify>
  <done>AuditTrail displays ErrorState component with retry button on network error. Dashboard Weekly Summary confirmed using design token classes with no hardcoded purple/green/gray colors.</done>
</task>

<task type="auto">
  <name>Task 2: Wire InstrumentBadge to list pages and fix RTL logical padding</name>
  <files>src/pages/Teachers.tsx, src/pages/Students.tsx, src/features/students/details/components/StudentTabNavigation.tsx, src/features/teachers/details/components/TeacherTabNavigation.tsx</files>
  <action>
**SC3 — Wire InstrumentBadge:**

1. Open `src/pages/Teachers.tsx`.
2. Add import: `import { InstrumentBadge } from '../components/domain'`
3. Find the columns definition array. Locate the `specialization` column (key: 'specialization'). It currently renders as plain text.
4. Add a `render` function to the specialization column:
   ```tsx
   render: (row: any) => row.specialization && row.specialization !== 'לא צוין'
     ? <InstrumentBadge instrument={row.specialization} />
     : <span className="text-muted-foreground">לא צוין</span>
   ```
   If the column already has a render function, replace its body with the above. If it only has `key` and `header`, add the `render` property.

5. Open `src/pages/Students.tsx`.
6. Add import: `import { InstrumentBadge } from '../components/domain'`
7. Find the columns definition array. Locate the `instrument` column (key: 'instrument').
8. Add/update the `render` function:
   ```tsx
   render: (student: any) => student.instrument
     ? <InstrumentBadge instrument={student.instrument} />
     : <span className="text-muted-foreground">—</span>
   ```

**SC4 — RTL logical padding:**

9. Open `src/features/teachers/details/components/TeacherTabNavigation.tsx`.
10. Find the mobile `<nav>` element (approximately line 76). It has `className="flex gap-3 px-4 py-3 min-w-max"`.
11. Replace `px-4` with `ps-4 pe-4` in that className string. Result: `className="flex gap-3 ps-4 pe-4 py-3 min-w-max"`.
12. Do NOT change `px-4` on the individual button elements inside the nav — those are symmetric button padding and are correct as-is.

13. Open `src/features/students/details/components/StudentTabNavigation.tsx`.
14. Find the mobile `<nav>` element (approximately line 79). Same pattern.
15. Replace `px-4` with `ps-4 pe-4` in that className string. Result: `className="flex gap-3 ps-4 pe-4 py-3 min-w-max"`.
16. Do NOT change `px-4` on the individual button elements inside the nav.
  </action>
  <verify>
1. `grep -n "InstrumentBadge" src/pages/Teachers.tsx` shows import and render usage
2. `grep -n "InstrumentBadge" src/pages/Students.tsx` shows import and render usage
3. `grep -n "ps-4 pe-4" src/features/teachers/details/components/TeacherTabNavigation.tsx` shows the nav element
4. `grep -n "ps-4 pe-4" src/features/students/details/components/StudentTabNavigation.tsx` shows the nav element
5. `grep -n "InstrumentBadge" src/ -r` shows Teachers.tsx, Students.tsx, domain/InstrumentBadge.tsx, domain/index.ts, and DesignSystem.tsx — no longer orphaned
6. TypeScript check: `npx tsc --noEmit --pretty 2>&1 | grep -i "Teachers\|Students\|TabNavigation"` shows no NEW errors from these changes
  </verify>
  <done>InstrumentBadge renders as styled badges in Teachers specialization and Students instrument columns. Mobile tab navigation nav elements use ps-4 pe-4 logical padding instead of px-4 physical padding.</done>
</task>

</tasks>

<verification>
Run all checks to confirm the four success criteria:

1. **SC1 (AuditTrail ErrorState):** `grep -c "ErrorState" src/pages/AuditTrail.tsx` returns >= 2 (import + usage). `grep -c "bg-red-50" src/pages/AuditTrail.tsx` returns 0.
2. **SC2 (Dashboard tokens):** `grep -n "bg-purple-50\|text-purple-600\|bg-green-50" src/pages/Dashboard.tsx` returns 0 results in lines 507-527.
3. **SC3 (InstrumentBadge):** `grep -rn "InstrumentBadge" src/pages/` returns matches in Teachers.tsx and Students.tsx.
4. **SC4 (RTL padding):** `grep -rn "ps-4 pe-4" src/features/` returns matches in both TabNavigation files.
5. **No regressions:** `npx tsc --noEmit` produces no new errors beyond pre-existing ones.
</verification>

<success_criteria>
- AuditTrail uses ErrorState component with onRetry={handleRetry} — no inline red div
- Dashboard Weekly Summary confirmed clean of hardcoded purple/green/gray colors
- InstrumentBadge imported and rendered in Teachers.tsx and Students.tsx list columns
- TeacherTabNavigation and StudentTabNavigation mobile nav use ps-4 pe-4 logical padding
- Zero new TypeScript errors introduced
</success_criteria>

<output>
After completion, create `.planning/phases/15-tech-debt-sweep/15-01-SUMMARY.md`
</output>
