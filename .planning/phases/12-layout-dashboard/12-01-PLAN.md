---
phase: 12-layout-dashboard
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/Sidebar.tsx
  - src/components/Header.tsx
  - src/components/Layout.tsx
autonomous: true

must_haves:
  truths:
    - "Sidebar background is dark warm (bg-sidebar token) — not white or generic gray"
    - "All text, borders, inputs, badges, and skeleton elements inside the sidebar are legible on the dark background — no invisible gray-on-dark"
    - "The currently active nav item is visually distinct with a highlighted background — identifiable without reading labels"
    - "The Header avatar button uses warm coral primary token — not indigo"
    - "The desktop floating toggle button uses primary token — not indigo"
    - "Layout main area uses bg-background token — not hardcoded bg-gray-50"
    - "Responsive collapse at 768px works identically to before — sidebar slides out, no horizontal scroll"
  artifacts:
    - path: "src/components/Sidebar.tsx"
      provides: "Dark warm sidebar with NavLink active state"
      contains: "NavLink"
    - path: "src/components/Header.tsx"
      provides: "Header with warm primary tokens replacing indigo"
      contains: "bg-primary"
    - path: "src/components/Layout.tsx"
      provides: "Layout shell with design token background"
      contains: "bg-background"
  key_links:
    - from: "src/components/Sidebar.tsx"
      to: "react-router-dom NavLink"
      via: "import { NavLink } from 'react-router-dom'"
      pattern: "NavLink"
    - from: "src/components/Sidebar.tsx"
      to: "CSS token --sidebar"
      via: "bg-sidebar class"
      pattern: "bg-sidebar"
---

<objective>
Restyle the sidebar, header, and layout shell with warm design tokens. The sidebar gets a dark warm background (bg-sidebar), NavLink replaces Link+isActive for active nav highlighting, and all internal text/border/input/badge colors are updated for dark-background legibility. The header avatar and toggle buttons switch from indigo to primary coral. Layout background uses the CSS token.

Purpose: The layout shell is the first thing every user sees on every page. Converting it from generic white/gray/indigo to the warm design token system makes the entire app feel cohesive with all the content pages already redesigned in Phases 6-11.

Output: Warm sidebar + header + layout visually matching the design system. NavLink-based active state.
</objective>

<execution_context>
@/home/yona279/.claude/get-shit-done/workflows/execute-plan.md
@/home/yona279/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-layout-dashboard/12-RESEARCH.md
@src/components/Sidebar.tsx
@src/components/Header.tsx
@src/components/Layout.tsx
@src/index.css (for :root CSS token values)
@tailwind.config.js (for sidebar token mapping)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restyle Sidebar with dark warm background and NavLink active state</name>
  <files>src/components/Sidebar.tsx</files>
  <action>
This task converts the sidebar from white/gray to the dark warm sidebar token and replaces Link+isActive with NavLink for active nav highlighting. The file is 686 lines — many class strings need systematic color replacement.

**Step 1: Import NavLink instead of Link**

Replace `import { Link, useLocation, useNavigate } from 'react-router-dom'` with `import { NavLink, useLocation, useNavigate } from 'react-router-dom'`. Remove the `isActive` useCallback (line 144) since NavLink handles this natively.

**Step 2: Sidebar container — dark background**

Change the main sidebar `<div id="sidebar">` classes from:
```
bg-white border-l border-gray-200 shadow-[-4px_0_6px_-1px_rgba(0,0,0,0.1)]
```
to:
```
bg-sidebar text-sidebar-foreground border-l border-sidebar-foreground/10 shadow-[-4px_0_6px_-1px_rgba(0,0,0,0.2)]
```

**Step 3: Desktop toggle button inside sidebar**

Change from `bg-gray-50 rounded-lg border border-gray-200 hover:bg-indigo-50 hover:border-indigo-300` to `bg-sidebar-foreground/10 rounded-lg border border-sidebar-foreground/20 hover:bg-sidebar-foreground/15 hover:border-sidebar-foreground/30`. Change icon from `text-gray-600` / `text-indigo-600` to `text-sidebar-foreground/70` / `text-sidebar-foreground`.

**Step 4: Desktop floating open button (outside sidebar)**

Change from `bg-white rounded-lg shadow-lg border border-gray-200 hover:bg-indigo-50 hover:border-indigo-300` to `bg-card rounded-lg shadow-lg border border-border hover:bg-primary/10 hover:border-primary/30`. Change icon from `text-indigo-600` to `text-primary`.

**Step 5: Mobile hamburger button**

Keep `bg-white rounded-lg shadow-lg border` (it sits against page background, not sidebar). Change `border-gray-200 hover:bg-gray-50` to `border-border hover:bg-muted`. Change icon from `text-gray-600` to `text-foreground`.

**Step 6: Search input section**

- Container: `border-b border-gray-100` → `border-b border-sidebar-foreground/10`
- Search icon: `text-gray-400` → `text-sidebar-foreground/40`
- Input: `bg-gray-50 border border-gray-200 ... focus:ring-blue-500` → `bg-sidebar-foreground/10 border border-sidebar-foreground/20 text-sidebar-foreground placeholder:text-sidebar-foreground/40 focus:ring-sidebar-foreground/30 focus:border-sidebar-foreground/30`

**Step 7: Role badges section**

- Container: `border-b border-gray-100` → `border-b border-sidebar-foreground/10`
- Individual badge colors need to work on dark background. Update `getRoleBadgeColor`:
  - admin: `bg-red-500/20 text-red-300`
  - teacher: `bg-blue-500/20 text-blue-300`
  - conductor: `bg-green-500/20 text-green-300`
  - theory-teacher: `bg-yellow-500/20 text-yellow-300`
  - default: `bg-sidebar-foreground/15 text-sidebar-foreground/70`

**Step 8: Loading skeleton**

- `bg-gray-200` → `bg-sidebar-foreground/20`

**Step 9: Category labels**

- `text-gray-500 ... hover:text-gray-700` → `text-sidebar-foreground/50 ... hover:text-sidebar-foreground/70`
- ChevronDown: keep existing transition

**Step 10: Navigation items — replace Link with NavLink**

Replace the `<Link>` element inside the navigation items map with `<NavLink>`. The key change:

```tsx
<NavLink
  key={`${category.key}-${item.href}-${item.name}`}
  to={item.href}
  end={item.href === '/dashboard'}
  onClick={closeMobileMenu}
  className={({ isActive: active }) =>
    `flex items-center justify-between px-4 py-3 mx-3 rounded-xl text-sm font-medium transition-all duration-150 rtl ${
      active
        ? 'bg-sidebar-foreground/15 text-sidebar-foreground font-semibold border border-sidebar-foreground/20'
        : 'text-sidebar-foreground/70 hover:bg-sidebar-foreground/8 hover:text-sidebar-foreground'
    }`
  }
>
```

Remove the `const active = isActive(item.href)` line inside the map since NavLink provides it via the className function. Note: use `rounded-xl` instead of `rounded-lg` for the warmer feel per research. Add `end` prop when `item.href === '/dashboard'` to prevent broad matching.

Also update the role badge inside nav items: the existing `getRoleBadgeColor` already returns the dark-compatible colors from Step 7, so inline role badges will inherit correctly.

**Step 11: Quick actions section**

- Separator: `border-t border-gray-200` → `border-t border-sidebar-foreground/10`
- Section title: `text-gray-500` → `text-sidebar-foreground/50`
- Button text: `text-gray-600 hover:bg-green-50 hover:text-green-700` → `text-sidebar-foreground/70 hover:bg-sidebar-foreground/10 hover:text-sidebar-foreground`
- Plus icon: `group-hover:text-green-500` → `group-hover:text-sidebar-foreground`

**Important notes:**
- Do NOT change the SidebarContext state management, modal logic, or navigation data arrays — only visual classes
- Do NOT change the z-index stack (sidebar z-[55], hamburger z-[60], backdrop z-[50])
- Keep the `font-reisinger-yonatan` classes on text elements
- The modals at bottom of file (StudentForm, AddTeacherModal, etc.) keep their existing `bg-white` because they are overlay modals, not part of sidebar surface
  </action>
  <verify>
Run `grep -c "bg-white" src/components/Sidebar.tsx` — should show only modal-related bg-white (3-4 occurrences for overlay modals), NOT the sidebar container itself.
Run `grep "NavLink" src/components/Sidebar.tsx | head -5` — confirms NavLink is imported and used.
Run `grep "bg-sidebar" src/components/Sidebar.tsx | head -3` — confirms sidebar token is applied.
Run `grep "isActive.*useCallback" src/components/Sidebar.tsx` — should return empty (removed).
  </verify>
  <done>
Sidebar has dark warm background using bg-sidebar token. NavLink replaces Link+isActive for active nav highlighting with end prop on /dashboard. All text/border/input/badge/skeleton elements use sidebar-foreground opacity variants for dark-background legibility. Quick actions section uses sidebar-foreground colors. Modal overlays remain unchanged.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Header and Layout to use warm design tokens</name>
  <files>src/components/Header.tsx, src/components/Layout.tsx</files>
  <action>
**Header.tsx changes:**

1. **Header container:** Change `bg-white border-b border-gray-200` to `bg-card border-b border-border`. This uses the warm near-white card token (`30 20% 99%`) instead of pure white.

2. **Dashboard icon button (non-admin):** Change from:
   - `bg-indigo-50 border border-indigo-200 hover:bg-indigo-100 hover:border-indigo-300` → `bg-primary/10 border border-primary/20 hover:bg-primary/15 hover:border-primary/30`
   - `text-indigo-600` → `text-primary`

3. **Avatar button:** Change from:
   - `bg-indigo-600 hover:bg-indigo-700` → `bg-primary hover:bg-primary/90`
   - Text is already `text-white`, which maps to primary-foreground — correct.

4. **Dropdown menu label:** Change `text-gray-700` → `text-foreground`. The `text-muted-foreground` on role line is already correct.

5. **Profile dropdown item text:** Font class `font-reisinger-yonatan` stays. No other changes needed — the DropdownMenu uses CSS tokens from shadcn already.

**Layout.tsx changes:**

1. **Root div:** Change `bg-gray-50` to `bg-background`. This applies the warm background token (`30 25% 97%`).

2. **Main element:** Change `bg-gray-50` to `bg-background` (appears twice — on `<main>` and on inner `<div>`).

3. No other structural changes. The margin logic, transition classes, and sidebar detection remain unchanged.
  </action>
  <verify>
Run `grep "indigo" src/components/Header.tsx` — should return empty (all indigo references replaced).
Run `grep "bg-gray-50" src/components/Layout.tsx` — should return empty (all replaced with bg-background).
Run `grep "bg-card" src/components/Header.tsx` — confirms warm header background.
Run `grep "bg-primary" src/components/Header.tsx` — confirms primary token on avatar and dashboard button.
  </verify>
  <done>
Header uses bg-card warm background, avatar button uses bg-primary coral instead of indigo, dashboard icon button uses primary token. Layout root and main content areas use bg-background warm token instead of hardcoded bg-gray-50. All three layout shell components now use the design token system consistently.
  </done>
</task>

</tasks>

<verification>
1. `grep "bg-sidebar" src/components/Sidebar.tsx` — returns multiple matches confirming dark sidebar token
2. `grep "NavLink" src/components/Sidebar.tsx` — returns import and usage confirming active state pattern
3. `grep "indigo" src/components/Sidebar.tsx src/components/Header.tsx` — returns empty (all indigo removed)
4. `grep "bg-gray-50" src/components/Layout.tsx` — returns empty (replaced with bg-background)
5. `grep "bg-white" src/components/Sidebar.tsx` — only in modal overlay divs, not sidebar container
6. The responsive collapse mechanism (isMobile, isDesktopOpen, translate-x-full) is unchanged — no functional regression
</verification>

<success_criteria>
- Sidebar background uses the --sidebar CSS token (dark warm navy, not white)
- Active nav item is visually highlighted via NavLink className function
- All sidebar internal elements (text, borders, inputs, badges, skeletons, quick actions) use sidebar-foreground opacity variants — no invisible gray text on dark background
- Header avatar and toggle buttons use warm primary coral — no indigo anywhere
- Layout background uses --background CSS token — no hardcoded gray
- Responsive sidebar collapse behavior unchanged at 768px breakpoint
</success_criteria>

<output>
After completion, create `.planning/phases/12-layout-dashboard/12-01-SUMMARY.md`
</output>
