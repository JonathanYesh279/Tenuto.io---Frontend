---
phase: 10-list-pages
plan: 02
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - src/pages/Teachers.tsx
  - src/pages/Students.tsx
  - src/pages/Orchestras.tsx
  - src/pages/Rehearsals.tsx
  - src/pages/AuditTrail.tsx
autonomous: true

must_haves:
  truths:
    - "Teachers search input shows X clear button when text is present"
    - "Students search input shows X clear button when text is present"
    - "Orchestras search input shows X clear button when text is present"
    - "Rehearsals search input shows X clear button when text is present"
    - "Teachers results info shows contextual copy with 'מורים' entity label"
    - "Students results info shows contextual copy with 'תלמידים' entity label"
    - "AuditTrail uses shared Table.tsx instead of inline <table> markup"
    - "AuditTrail pagination uses Pagination component with 'רשומות' entity label"
    - "Rehearsals loading state uses TableSkeleton instead of spinner"
    - "Rehearsals empty state uses EmptyState component instead of inline JSX"
  artifacts:
    - path: "src/pages/Teachers.tsx"
      provides: "SearchInput wiring, contextual results-info copy"
      contains: "SearchInput"
    - path: "src/pages/Students.tsx"
      provides: "SearchInput wiring, contextual results-info copy"
      contains: "SearchInput"
    - path: "src/pages/Orchestras.tsx"
      provides: "SearchInput wiring"
      contains: "SearchInput"
    - path: "src/pages/Rehearsals.tsx"
      provides: "SearchInput wiring, TableSkeleton loading, EmptyState"
      contains: "SearchInput"
    - path: "src/pages/AuditTrail.tsx"
      provides: "Table.tsx migration, Pagination component wiring"
      contains: "import Table from"
  key_links:
    - from: "src/pages/AuditTrail.tsx"
      to: "src/components/ui/Table.tsx"
      via: "default import"
      pattern: "import Table from"
    - from: "src/pages/AuditTrail.tsx"
      to: "src/components/ui/Pagination.tsx"
      via: "default import"
      pattern: "import Pagination from"
    - from: "src/pages/Teachers.tsx"
      to: "src/components/ui/SearchInput.tsx"
      via: "named import"
      pattern: "import.*SearchInput"
    - from: "src/pages/Rehearsals.tsx"
      to: "src/components/feedback/Skeleton.tsx"
      via: "named import"
      pattern: "TableSkeleton"
---

<objective>
Wire all 5 list pages to the upgraded shared components from Plan 10-01: replace inline search inputs with SearchInput, upgrade contextual copy, migrate AuditTrail from inline table to shared Table.tsx + Pagination.tsx, and migrate Rehearsals to use TableSkeleton + EmptyState.

Purpose: All 5 list pages share identical table chrome, search-with-clear, and contextual pagination — fulfilling TABLE-01 through TABLE-05.
Output: All 5 pages consistently using shared components.
</objective>

<execution_context>
@/home/yona279/.claude/get-shit-done/workflows/execute-plan.md
@/home/yona279/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-list-pages/10-RESEARCH.md
@.planning/phases/10-list-pages/10-01-SUMMARY.md
@src/pages/Teachers.tsx
@src/pages/Students.tsx
@src/pages/Orchestras.tsx
@src/pages/Rehearsals.tsx
@src/pages/AuditTrail.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire SearchInput to Teachers, Students, and Orchestras + upgrade contextual copy</name>
  <files>src/pages/Teachers.tsx, src/pages/Students.tsx, src/pages/Orchestras.tsx</files>
  <action>
For each of the three pages, replace the inline search `<input>` + `<Search>` icon pattern with the new `SearchInput` component.

**Teachers.tsx (~lines 559-568):**
1. Add import: `import { SearchInput } from '../components/ui/SearchInput'`
2. Remove the `Search` icon import from lucide-react (if no longer used elsewhere in the file — check first; Teachers uses Search icon only for the search input).
3. Replace the `<div className="relative">...<Search>...<input>...</div>` block with:
   ```tsx
   <SearchInput
     value={searchTerm}
     onChange={(value) => setSearchTerm(value)}
     onClear={() => setSearchTerm('')}
     placeholder="חיפוש מורים..."
     isLoading={searchLoading}
   />
   ```
4. Update the results-info text (~lines 707-713). The existing copy is:
   - With filters: `מציג {filteredTeachers.length} מורים מתוך {totalTeachers} סה"כ`
   - Without filters: `מציג {teachers.length} מתוך {totalTeachers} מורים`
   These are inline strings in the "Load More" infinite scroll pattern. Keep them as-is but ensure the entity name "מורים" is used (it already is). No Pagination.tsx wiring needed — Teachers uses Load More, not page-based pagination.

**Students.tsx (~lines 836-845):**
1. Add import: `import { SearchInput } from '../components/ui/SearchInput'`
2. Remove the `Search` icon import from lucide-react if no longer used elsewhere.
3. Replace the inline search input block with:
   ```tsx
   <SearchInput
     value={searchTerm}
     onChange={(value) => setSearchTerm(value)}
     onClear={() => setSearchTerm('')}
     placeholder="חיפוש תלמידים..."
     isLoading={searchLoading}
   />
   ```
4. Same as Teachers — results-info copy already uses "תלמידים", no Pagination.tsx wiring needed.

**Orchestras.tsx (~lines 296-305):**
1. Add import: `import { SearchInput } from '../components/ui/SearchInput'`
2. Remove `Search` from lucide-react if no longer used elsewhere.
3. Replace the inline search input block with:
   ```tsx
   <SearchInput
     value={searchQuery}
     onChange={(value) => setSearchQuery(value)}
     onClear={() => setSearchQuery('')}
     placeholder="חיפוש תזמורות..."
   />
   ```
   No `isLoading` needed — Orchestras doesn't have debounced search loading state.

**Important:** For all three pages, when removing the `<div className="relative">` wrapper around the old search input, ensure the SearchInput component is placed in the same structural position (inside the flex container that houses filters). The SearchInput already has `relative` positioning internally.

Do NOT change pagination mode for Teachers/Students (keep Load More). Do NOT change filter inputs (instrument, orchestra, status dropdowns). Only replace the main text search input.
  </action>
  <verify>
For each page (Teachers.tsx, Students.tsx, Orchestras.tsx):
1. Grep for `SearchInput` import
2. Grep for `onClear` prop (confirms X button wiring)
3. Confirm no duplicate `<Search` icon in the search area (old pattern removed)
4. Confirm old inline `<input type="text"` for search is gone
  </verify>
  <done>Teachers, Students, and Orchestras search inputs replaced with SearchInput component showing X clear button. Results-info copy unchanged (already contextual). Pagination mode unchanged (Load More stays).</done>
</task>

<task type="auto">
  <name>Task 2: Wire Rehearsals (SearchInput + TableSkeleton + EmptyState) and AuditTrail (Table.tsx + Pagination migration)</name>
  <files>src/pages/Rehearsals.tsx, src/pages/AuditTrail.tsx</files>
  <action>
**Rehearsals.tsx:**

1. Add imports:
   ```tsx
   import { SearchInput } from '../components/ui/SearchInput'
   import { TableSkeleton } from '../components/feedback/Skeleton'
   import { EmptyState } from '../components/feedback/EmptyState'
   ```

2. Replace the inline search input (~lines 466-475) with:
   ```tsx
   <SearchInput
     value={filters.searchQuery}
     onChange={(value) => handleFilterChange('searchQuery', value)}
     onClear={() => handleFilterChange('searchQuery', '')}
     placeholder="חיפוש חזרות..."
   />
   ```

3. Replace the loading spinner (~lines 382-391) with `TableSkeleton`:
   ```tsx
   if (loading) {
     return <TableSkeleton rows={6} cols={5} />
   }
   ```
   Keep the same early-return pattern but use TableSkeleton instead of the manual spinner div.

4. Replace the inline empty state (~lines 700-718) with `EmptyState`:
   ```tsx
   <EmptyState
     icon={Calendar}
     title="אין חזרות"
     description={
       Object.values(filters).some(f => f && f !== 'all')
         ? 'לא נמצאו חזרות התואמות למסננים'
         : 'התחל על ידי יצירת החזרה הראשונה'
     }
     actionLabel={!Object.values(filters).some(f => f && f !== 'all') ? 'צור חזרה חדשה' : undefined}
     onAction={!Object.values(filters).some(f => f && f !== 'all') ? () => setShowCreateForm(true) : undefined}
   />
   ```
   Check EmptyState's actual props (icon, title, description, actionLabel, onAction) from `src/components/feedback/EmptyState.tsx` before wiring — adjust prop names if they differ.

5. Remove `Search` from lucide-react import if no longer used elsewhere in the file (check — Rehearsals may use it only for the search input).

**AuditTrail.tsx:**

This is the biggest change — migrate from inline `<table>` to shared `Table.tsx` and from inline pagination to `Pagination.tsx`.

1. Add imports:
   ```tsx
   import Table from '../components/ui/Table'
   import Pagination from '../components/ui/Pagination'
   import { TableSkeleton } from '../components/feedback/Skeleton'
   ```

2. Remove `ChevronLeft`, `ChevronRight` from lucide-react imports (no longer needed — Pagination handles its own icons).

3. Define two column arrays for the two tabs:

   **Deletion log columns** (6 columns):
   ```tsx
   const deletionLogColumns = [
     { key: 'timestamp', label: 'תאריך', render: (row: any) => formatDate(row.timestamp) },
     { key: 'action', label: 'פעולה' },
     { key: 'entityType', label: 'סוג', render: (row: any) => getEntityTypeLabel(row.entityType) },
     { key: 'entityName', label: 'שם' },
     { key: 'adminName', label: 'מנהל', render: (row: any) => row.performedBy?.adminName || '-' },
     { key: 'status', label: 'סטטוס', render: (row: any) => getStatusBadge(row.status) },
   ]
   ```

   **Past activities columns** (5 columns):
   ```tsx
   const pastActivitiesColumns = [
     { key: 'date', label: 'תאריך', render: (row: any) => formatDate(row.date) },
     { key: 'type', label: 'סוג', render: (row: any) => getActivityTypeLabel(row.type) },
     { key: 'details', label: 'פרטים' },
     { key: 'teacher', label: 'מורה', render: (row: any) => row.teacher ? `${row.teacher.firstName} ${row.teacher.lastName}` : '-' },
     { key: 'students', label: 'תלמידים', render: (row: any) => row.students?.length > 0 ? row.students.map((s: any) => `${s.firstName} ${s.lastName}`).join(', ') : '-' },
   ]
   ```

4. Replace the inline `<table>` for deletion log (~lines 320-368) with:
   ```tsx
   <Table
     columns={deletionLogColumns}
     data={auditLog.auditEntries}
   />
   ```

5. Replace the inline pagination for deletion log (~lines 371-395) with:
   ```tsx
   <Pagination
     currentPage={auditPage}
     totalPages={auditLog.pagination.pages}
     totalItems={auditLog.pagination.total}
     itemsPerPage={20}
     onPageChange={setAuditPage}
     entityLabel="רשומות"
     showItemsPerPage={false}
   />
   ```

6. Replace the inline `<table>` for past activities (~lines 449-497) with:
   ```tsx
   <Table
     columns={pastActivitiesColumns}
     data={pastActivities}
   />
   ```

7. Replace the inline pagination for past activities (~lines 500-528) with:
   ```tsx
   {activitiesPagination && (
     <Pagination
       currentPage={activitiesPage}
       totalPages={activitiesPagination.pages}
       totalItems={activitiesPagination.total}
       itemsPerPage={20}
       onPageChange={setActivitiesPage}
       entityLabel="רשומות"
       showItemsPerPage={false}
     />
   )}
   ```

8. Replace the loading spinners (~lines 303-307 and 432-436) with `<TableSkeleton rows={5} cols={6} />` and `<TableSkeleton rows={5} cols={5} />` respectively.

9. Remove `FileText` from lucide-react import if no longer used. Remove `RefreshCw` only if the error retry button no longer uses it (check — the error state still uses RefreshCw, so keep it).

**Important caveats:**
- The `Table.tsx` component accepts `data` as `Record<string, ReactNode>[]`. AuditTrail's data objects (`AuditEntry`, `PastActivity`) are compatible because they have string keys with values.
- The `render` function in Table columns receives the full row object, so formatDate/getEntityTypeLabel/getStatusBadge work as expected.
- Keep the existing error state banner as-is (it's a custom inline error with retry — matches the page's filter-based interaction model).
  </action>
  <verify>
**Rehearsals.tsx:**
1. Grep for `SearchInput` import
2. Grep for `TableSkeleton` import
3. Grep for `EmptyState` import (from feedback/)
4. Confirm no manual spinner div remains (no `animate-spin.*border-b-2.*border-primary`)

**AuditTrail.tsx:**
1. Grep for `import Table from` (shared Table component)
2. Grep for `import Pagination from`
3. Grep for `entityLabel="רשומות"` in Pagination usage
4. Confirm no inline `<table>` or `<thead>` markup remains
5. Confirm no inline pagination buttons (ChevronLeft/ChevronRight) remain
6. Grep for `TableSkeleton` import
  </verify>
  <done>Rehearsals uses SearchInput, TableSkeleton, and EmptyState. AuditTrail uses shared Table.tsx (both tabs) and Pagination.tsx (both tabs) with contextual "רשומות" label. All 5 list pages now share identical table chrome.</done>
</task>

</tasks>

<verification>
1. All 5 pages import SearchInput (except AuditTrail which has no search — only date/type filters)
2. AuditTrail uses shared Table.tsx for both deletion-log and past-activities tabs
3. AuditTrail uses Pagination component for both tabs with entityLabel="רשומות"
4. Rehearsals loading state uses TableSkeleton
5. Rehearsals empty state uses EmptyState component
6. No inline `<table>` markup remains in AuditTrail
7. All pages compile without import errors
</verification>

<success_criteria>
- Searching on any list page and typing text shows an X clear button; clicking it clears and resets
- AuditTrail renders with the same table chrome (hover, headers, spacing) as Teachers/Students/Orchestras
- AuditTrail pagination shows "מציג X–Y מתוך Z רשומות"
- Rehearsals shows skeleton loading instead of spinner
- Rehearsals shows EmptyState component instead of inline empty markup
- All 5 pages use identical table header styles, row heights, and hover states
</success_criteria>

<output>
After completion, create `.planning/phases/10-list-pages/10-02-SUMMARY.md`
</output>
