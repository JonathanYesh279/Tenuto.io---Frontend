---
phase: 13-special-pages
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/MinistryReports.tsx
  - src/pages/ImportData.tsx
  - src/index.css
  - src/components/Layout.tsx
autonomous: true

must_haves:
  truths:
    - "MinistryReports shows a 3-step horizontal progress indicator (select year, check status, download) that reflects data state"
    - "ImportData shows a 3-step horizontal progress indicator (upload, preview, results) that updates as importState changes"
    - "The step indicators on both pages look visually identical (same StepProgress component, same horizontal layout)"
    - "Printing MinistryReports hides the sidebar and header — only report content is visible"
    - "Printing MinistryReports shows the main content at full width — no 280px right gutter from sidebar margin"
    - "MinistryReports buttons use bg-primary (warm coral) instead of bg-primary-600 (old blue hex)"
  artifacts:
    - path: "src/pages/MinistryReports.tsx"
      provides: "Ministry reports with step progress indicator"
      contains: "StepProgress"
    - path: "src/pages/ImportData.tsx"
      provides: "Import data with step progress indicator"
      contains: "StepProgress"
    - path: "src/index.css"
      provides: "Print styles for hiding nav and resetting margins"
      contains: "margin-right: 0 !important"
    - path: "src/components/Layout.tsx"
      provides: "no-print class on sidebar and header wrappers"
      contains: "no-print"
  key_links:
    - from: "src/pages/MinistryReports.tsx"
      to: "src/components/feedback/ProgressIndicators.tsx"
      via: "StepProgress import"
      pattern: "import.*StepProgress.*from.*ProgressIndicators"
    - from: "src/pages/ImportData.tsx"
      to: "src/components/feedback/ProgressIndicators.tsx"
      via: "StepProgress import"
      pattern: "import.*StepProgress.*from.*ProgressIndicators"
    - from: "src/index.css"
      to: "src/components/Layout.tsx"
      via: "no-print class applied to sidebar/header, print rule hides them"
      pattern: "no-print"
---

<objective>
Wire StepProgress indicators on MinistryReports and ImportData, add print styles for MinistryReports, and fix remaining hardcoded palette tokens on these pages.

Purpose: MinistryReports and ImportData have multi-step flows but no visual step indicator — users cannot see where they are in the process. Adding StepProgress (already built in Phase 8) provides clarity. Print styles allow MinistryReports to be printed cleanly without navigation chrome.

Output: 2 pages with step indicators, print stylesheet, Layout print wiring.
</objective>

<execution_context>
@/home/yona279/.claude/get-shit-done/workflows/execute-plan.md
@/home/yona279/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-special-pages/13-RESEARCH.md
@src/pages/MinistryReports.tsx
@src/pages/ImportData.tsx
@src/components/feedback/ProgressIndicators.tsx
@src/index.css
@src/components/Layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: MinistryReports step indicator + token fixes</name>
  <files>
    src/pages/MinistryReports.tsx
  </files>
  <action>
**Add StepProgress to MinistryReports:**

1. Add import: `import { StepProgress } from '../components/feedback/ProgressIndicators'`

2. Create a step computation function. The step indicator is **purely presentational** — do NOT restructure the page into a wizard. Steps reflect data state:

```tsx
const getMinistrySteps = () => {
  const steps = [
    {
      id: 'year',
      label: 'בחר שנה',
      description: 'שנת לימודים',
      status: selectedYear ? 'completed' as const : 'current' as const,
    },
    {
      id: 'validate',
      label: 'בדוק סטטוס',
      description: 'נתונים ואימות',
      status: (!selectedYear
        ? 'pending' as const
        : endpointsAvailable && (status?.preExportErrors?.length ?? 0) === 0
          ? 'completed' as const
          : 'current' as const),
    },
    {
      id: 'download',
      label: 'הורד דוח',
      description: 'ייצוא למשרד',
      status: (endpointsAvailable && (status?.missing?.length === 0) && validation?.isValid
        ? 'current' as const
        : 'pending' as const),
    },
  ]
  return steps
}
```

3. Insert the `<StepProgress>` component AFTER the school year selector and BEFORE the info banner / completion card. Place it as a new section:
```tsx
{/* Step Progress Indicator */}
<div className="mb-6">
  <StepProgress
    steps={getMinistrySteps()}
    direction="horizontal"
  />
</div>
```
Insert this right after the closing `</div>` of the school year selector section (after line ~246 in current file).

**Token fixes on MinistryReports:**

4. Page header icon container: `bg-primary-100` is fine (light tint), but `text-primary-600` → `text-primary`

5. Overall completion percentage text: `text-primary-600` → `text-primary`

6. Download button: `bg-primary-600` → `bg-primary`, `hover:bg-primary-700` → `hover:bg-primary/90`

7. Loading spinner: `border-primary-600` → `border-primary`

8. School year select: `focus:ring-primary-500 focus:border-primary-500` → `focus:ring-ring focus:border-ring`

**DO NOT touch the info banner colors** (`border-blue-200 bg-blue-50 text-blue-600 text-blue-800`) — these are semantic information colors, not brand tokens.
  </action>
  <verify>
Run: `grep -n "StepProgress" src/pages/MinistryReports.tsx`
Expected: import line + JSX usage (2+ matches).

Run: `grep -n "primary-600\|primary-700\|primary-500" src/pages/MinistryReports.tsx`
Expected: zero matches for interactive elements. Only `bg-primary-100` palette tint may remain for backgrounds.

Run: `grep -c "primary-100" src/pages/MinistryReports.tsx`
Expected: allowed — bg-primary-100 is a light background tint (not the primary CTA color trap).
  </verify>
  <done>MinistryReports shows a 3-step horizontal progress indicator reflecting year selection, validation status, and download readiness. All interactive tokens (buttons, focus rings) use warm CSS var tokens. The info banner keeps semantic blue.</done>
</task>

<task type="auto">
  <name>Task 2: ImportData step indicator + print styles + Layout print wiring</name>
  <files>
    src/pages/ImportData.tsx
    src/index.css
    src/components/Layout.tsx
  </files>
  <action>
**Add StepProgress to ImportData:**

1. Add import: `import { StepProgress } from '../components/feedback/ProgressIndicators'`

2. Create a step status helper that maps the existing `importState` variable to step statuses:
```tsx
const IMPORT_STEPS = [
  { id: 'upload', label: 'העלאת קובץ' },
  { id: 'preview', label: 'תצוגה מקדימה' },
  { id: 'results', label: 'תוצאות' },
] as const

const getImportSteps = () => {
  const order = ['upload', 'preview', 'results'] as const
  const currentIdx = order.indexOf(importState)
  return IMPORT_STEPS.map((step, idx) => ({
    ...step,
    description: undefined as string | undefined,
    status: (idx < currentIdx ? 'completed' : idx === currentIdx ? 'current' : 'pending') as 'completed' | 'current' | 'pending',
  }))
}
```

3. Insert the `<StepProgress>` component AFTER the tab switcher buttons and BEFORE the import state content. Place it between the tab buttons `</div>` (line ~204) and the `{/* Upload State */}` comment:
```tsx
{/* Step Progress Indicator */}
<div className="mb-6">
  <StepProgress
    steps={getImportSteps()}
    direction="horizontal"
  />
</div>
```

**Token fixes on ImportData:**

4. Page header icon: `text-primary-600` → `text-primary`
5. Loading spinner: `border-primary-600` → `border-primary`
6. Execute/import button (preview state): `bg-primary-600` → `bg-primary`, `hover:bg-primary-700` → `hover:bg-primary/90`
7. "Import another" button (results state): `bg-primary-600` → `bg-primary`, `hover:bg-primary-700` → `hover:bg-primary/90`
8. Tab button active state: `bg-primary-100 text-primary-700 border border-primary-200` — keep `bg-primary-100` and `border-primary-200` (palette light tints are fine), but change `text-primary-700` → `text-primary`

**Print styles — src/index.css:**

9. Expand the existing `@media print` block (currently only has `.no-print`). Add these rules INSIDE the existing block (do not create a second @media print block):
```css
  /* Override inline sidebar margin for print */
  main {
    margin-right: 0 !important;
    margin-left: 0 !important;
  }
  /* Clean card borders for print — no shadows */
  .rounded-lg, .rounded-xl {
    box-shadow: none !important;
    border: 1px solid #e5e7eb !important;
  }
  /* Avoid page breaks inside cards */
  .break-inside-avoid, [class*="Card"] {
    break-inside: avoid;
  }
```

**Layout print wiring — src/components/Layout.tsx:**

10. Neither Sidebar nor Header accept a `className` prop. Wrap them with `no-print` divs:

Change:
```tsx
{shouldShowSidebar && <Sidebar />}
```
to:
```tsx
{shouldShowSidebar && <div className="no-print"><Sidebar /></div>}
```

Change:
```tsx
<Header />
```
to:
```tsx
<div className="no-print"><Header /></div>
```

This ensures both are hidden when printing.
  </action>
  <verify>
Run: `grep -n "StepProgress" src/pages/ImportData.tsx`
Expected: import line + JSX usage (2+ matches).

Run: `grep -n "primary-600\|primary-700" src/pages/ImportData.tsx`
Expected: zero matches.

Run: `grep -n "margin-right: 0 !important" src/index.css`
Expected: 1 match (print override for sidebar margin).

Run: `grep -n "no-print" src/components/Layout.tsx`
Expected: 2 matches (sidebar wrapper + header wrapper).

Run: `grep -c "@media print" src/index.css`
Expected: exactly 1 (single print block, not duplicated).
  </verify>
  <done>ImportData shows a 3-step horizontal progress indicator that tracks upload/preview/results state. Print styles hide sidebar/header and reset main margin. Layout wraps Sidebar and Header in no-print divs. All interactive tokens on ImportData use warm CSS var tokens.</done>
</task>

</tasks>

<verification>
1. `grep -rn "StepProgress" src/pages/MinistryReports.tsx src/pages/ImportData.tsx` — both files import and use StepProgress
2. `grep -rn "primary-600\|primary-700" src/pages/MinistryReports.tsx src/pages/ImportData.tsx` — zero matches
3. `grep -n "no-print" src/components/Layout.tsx` — 2 matches (sidebar + header wrappers)
4. `grep -c "@media print" src/index.css` — exactly 1 (single block)
5. `grep -n "margin-right: 0" src/index.css` — present in print block
6. `npx tsc --noEmit` — no NEW TypeScript errors in modified files (pre-existing errors may exist in other files)
</verification>

<success_criteria>
- MinistryReports: 3-step indicator (year/validate/download) visible, reflecting data state
- ImportData: 3-step indicator (upload/preview/results) visible, updating with importState
- Both indicators use the same StepProgress component and horizontal layout — visually consistent
- Print: sidebar and header hidden, main content full width, card borders clean
- All interactive tokens on both pages use warm CSS var tokens (bg-primary, ring-ring)
</success_criteria>

<output>
After completion, create `.planning/phases/13-special-pages/13-02-SUMMARY.md`
</output>
