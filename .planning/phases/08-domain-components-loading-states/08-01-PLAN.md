---
phase: 08-domain-components-loading-states
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/domain/InstrumentBadge.tsx
  - src/components/domain/StatusBadge.tsx
  - src/components/domain/AvatarInitials.tsx
  - src/components/domain/StatsCard.tsx
  - src/components/domain/index.ts
  - src/components/feedback/Skeleton.tsx
autonomous: true

must_haves:
  truths:
    - "InstrumentBadge renders instrument text inside a shadcn Badge with secondary variant"
    - "StatusBadge maps Hebrew status strings to shadcn Badge CVA variants (active/inactive/graduated/pending)"
    - "AvatarInitials renders a Radix Avatar with initials computed from nameUtils.getInitials()"
    - "StatsCard re-exports the dashboard StatCard as the canonical stats card"
    - "A Skeleton primitive exists with animate-pulse bg-muted and a TableSkeleton variant for list pages"
    - "All domain components are accessible via barrel import from src/components/domain"
  artifacts:
    - path: "src/components/domain/InstrumentBadge.tsx"
      provides: "Instrument text badge wrapping shadcn Badge"
      exports: ["InstrumentBadge"]
    - path: "src/components/domain/StatusBadge.tsx"
      provides: "Status-to-variant mapper wrapping shadcn Badge"
      exports: ["StatusBadge"]
    - path: "src/components/domain/AvatarInitials.tsx"
      provides: "Avatar with Hebrew initials fallback"
      exports: ["AvatarInitials"]
    - path: "src/components/domain/StatsCard.tsx"
      provides: "Canonical stats card re-export"
      exports: ["StatsCard"]
    - path: "src/components/feedback/Skeleton.tsx"
      provides: "Skeleton primitive and TableSkeleton composite"
      exports: ["Skeleton", "TableSkeleton"]
    - path: "src/components/domain/index.ts"
      provides: "Barrel export for all domain components"
  key_links:
    - from: "src/components/domain/StatusBadge.tsx"
      to: "src/components/ui/badge.tsx"
      via: "import Badge + variant prop mapping"
      pattern: "import.*Badge.*from.*badge"
    - from: "src/components/domain/AvatarInitials.tsx"
      to: "src/components/ui/avatar.tsx"
      via: "import Avatar/AvatarFallback"
      pattern: "import.*Avatar.*from.*avatar"
    - from: "src/components/domain/AvatarInitials.tsx"
      to: "src/utils/nameUtils.ts"
      via: "import getInitials"
      pattern: "import.*getInitials.*from.*nameUtils"
---

<objective>
Create the domain component library and Skeleton primitive for Phase 8.

Purpose: Build the conservatory-specific reusable components (InstrumentBadge, StatusBadge, AvatarInitials, StatsCard) and the Skeleton loading primitive that all subsequent plans and phases depend on. These components wrap shadcn primitives with music-school domain logic.

Output: 5 new domain component files + 1 feedback component file + 1 barrel export, all importable from `src/components/domain`.
</objective>

<execution_context>
@/home/yona279/.claude/get-shit-done/workflows/execute-plan.md
@/home/yona279/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-domain-components-loading-states/08-RESEARCH.md

Key existing files to reference (read before implementing):
@src/components/ui/badge.tsx — CVA variants: active, inactive, graduated, pending, secondary, outline
@src/components/ui/avatar.tsx — Radix Avatar/AvatarImage/AvatarFallback
@src/utils/nameUtils.ts — getInitials(personalInfo) already exists, takes {firstName?, lastName?, fullName?}
@src/components/dashboard/StatCard.tsx — Full-featured stat card with loading/error/trend (canonical version)
@src/components/ui/StatsCard.tsx — Simple stat card (legacy version)
@src/components/ui/DesignSystem.tsx — StatusBadge and InstrumentBadge exist here but use old patterns; domain/ replaces them
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create domain components (InstrumentBadge, StatusBadge, AvatarInitials, StatsCard)</name>
  <files>
    src/components/domain/InstrumentBadge.tsx
    src/components/domain/StatusBadge.tsx
    src/components/domain/AvatarInitials.tsx
    src/components/domain/StatsCard.tsx
    src/components/domain/index.ts
  </files>
  <action>
Create the `src/components/domain/` directory and build 4 domain components + barrel export.

**InstrumentBadge.tsx:**
- Thin wrapper on shadcn `Badge` with `variant="secondary"`.
- Props: `{ instrument: string; className?: string }`.
- Renders: `<Badge variant="secondary" className={className}>{instrument}</Badge>`.
- No department colors or icons (deferred to v2.1 MUSIC-01 per research decision).
- Import Badge from `@/components/ui/badge`.

**StatusBadge.tsx:**
- Maps Hebrew status strings to shadcn Badge CVA variants.
- Status map: `'פעיל' -> 'active'`, `'לא פעיל' -> 'inactive'`, `'בוגר' -> 'graduated'`, `'ממתין' -> 'pending'`.
- Props: `{ status: string; className?: string }`.
- Falls back to `variant="outline"` for unknown statuses.
- Import Badge from `@/components/ui/badge`.
- Do NOT delete DesignSystem.tsx StatusBadge — it's still imported elsewhere; migration happens in Phase 10.

**AvatarInitials.tsx:**
- Wraps shadcn `Avatar` + `AvatarFallback` from `@/components/ui/avatar`.
- Props: `{ firstName?: string; lastName?: string; fullName?: string; src?: string; size?: 'sm' | 'md' | 'lg'; className?: string }`.
- Uses `getInitials` from `@/utils/nameUtils` — note that `getInitials` takes a `PersonalInfoLike` object `{ firstName?, lastName?, fullName? }`, so pass `{ firstName, lastName, fullName }` to it.
- Size classes: `sm: 'h-8 w-8 text-xs'`, `md: 'h-10 w-10 text-sm'`, `lg: 'h-12 w-12 text-base'`.
- AvatarFallback styling: `bg-primary/10 text-primary font-semibold` (uses CSS var --primary, warm coral).
- If `src` prop provided, render `<AvatarImage src={src} />` before the fallback.

**StatsCard.tsx:**
- Re-export the dashboard `StatCard` as the canonical `StatsCard`.
- `export { default as StatsCard } from '@/components/dashboard/StatCard'`
- Also re-export `CompactStatCard`, `DetailedStatCard`, `ProgressStatCard` for completeness.

**index.ts (barrel export):**
```typescript
export { InstrumentBadge } from './InstrumentBadge'
export { StatusBadge } from './StatusBadge'
export { AvatarInitials } from './AvatarInitials'
export { StatsCard, CompactStatCard, DetailedStatCard, ProgressStatCard } from './StatsCard'
```
  </action>
  <verify>
Run `npx tsc --noEmit src/components/domain/index.ts 2>&1 | head -20` to verify TypeScript compilation.
If tsc isn't available, verify by reading each file and confirming imports resolve to existing files.
  </verify>
  <done>
All 4 domain components exist in src/components/domain/ with correct imports.
Barrel export in index.ts exports all components.
StatusBadge maps 4 Hebrew status strings to badge variants.
AvatarInitials uses getInitials() from nameUtils.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Skeleton primitive and TableSkeleton composite</name>
  <files>
    src/components/feedback/Skeleton.tsx
  </files>
  <action>
Create `src/components/feedback/Skeleton.tsx` following the shadcn Skeleton pattern.

**Skeleton primitive:**
- Props: `{ className?: string }`.
- Renders: `<div className={cn('animate-pulse rounded-md bg-muted', className)} />`.
- Import `cn` from `@/lib/utils`.
- Uses `bg-muted` (CSS variable-backed color from Phase 6 token system) instead of `bg-gray-200`.

**TableSkeleton composite:**
- Props: `{ rows?: number; cols?: number }`.
- Default `rows=8`, `cols=5`.
- Renders a table-shaped skeleton: header row + body rows.
- Header: a `div` with `border-b border-gray-100` containing `cols` Skeleton bars (h-4, varying widths).
- Body rows: each row is a flex container with `gap-4 px-4 py-3 border-b border-gray-100/50`, containing `cols` Skeleton bars.
- Column width pattern: first col `w-1/4` (name), last col `w-1/6` (actions), middle cols `w-1/5`.
- Add `role="status"` and `aria-label="טוען נתונים..."` to the outer container for accessibility.

**CardSkeleton composite (for grid views):**
- Props: `{ count?: number }`.
- Default `count=6`.
- Renders a grid of skeleton cards: `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4`.
- Each card: rounded-lg border p-6 with avatar circle skeleton + 3 text line skeletons.

Do NOT delete the existing `LoadingStates.tsx` — it's used in other components. `Skeleton.tsx` is a new file alongside it.

Export: `Skeleton`, `TableSkeleton`, `CardSkeleton`.
  </action>
  <verify>
Read the created file and confirm:
1. Skeleton uses `bg-muted` (not `bg-gray-200`)
2. TableSkeleton has `role="status"` and `aria-label`
3. File imports `cn` from `@/lib/utils`
  </verify>
  <done>
Skeleton.tsx exists in src/components/feedback/ with Skeleton primitive, TableSkeleton, and CardSkeleton.
Uses shadcn pattern (animate-pulse bg-muted) with proper accessibility attributes.
  </done>
</task>

</tasks>

<verification>
1. All files exist: `ls src/components/domain/*.tsx src/components/domain/index.ts src/components/feedback/Skeleton.tsx`
2. No duplicate StatusBadge confusion: DesignSystem.tsx StatusBadge is untouched; domain/StatusBadge.tsx is the new canonical one
3. getInitials import chain works: AvatarInitials -> nameUtils.getInitials -> accepts PersonalInfoLike object
4. Badge variant mapping covers all 4 Hebrew statuses: 'פעיל', 'לא פעיל', 'בוגר', 'ממתין'
</verification>

<success_criteria>
- `src/components/domain/` directory contains InstrumentBadge.tsx, StatusBadge.tsx, AvatarInitials.tsx, StatsCard.tsx, index.ts
- `src/components/feedback/Skeleton.tsx` contains Skeleton, TableSkeleton, CardSkeleton
- All imports resolve to existing codebase files (badge.tsx, avatar.tsx, nameUtils.ts, StatCard.tsx)
- Barrel export provides single import point for all domain components
</success_criteria>

<output>
After completion, create `.planning/phases/08-domain-components-loading-states/08-01-SUMMARY.md`
</output>
