---
phase: 19-dashboard-transformation
plan: 02
type: execute
wave: 2
depends_on: ["19-01"]
files_modified:
  - src/components/dashboard/widgets/MiniCalendarWidget.tsx
  - src/components/dashboard/widgets/UpcomingEventsWidget.tsx
  - src/components/dashboard/widgets/RecentActivityWidget.tsx
  - src/components/dashboard/widgets/index.ts
  - src/pages/Dashboard.tsx
autonomous: true

must_haves:
  truths:
    - "Right sidebar column contains a mini Hebrew calendar widget showing current month with day grid"
    - "Right sidebar column contains an upcoming events widget with rehearsal/event items from existing dashboard state"
    - "Right sidebar column contains a recent activity widget with activity items from existing dashboard state"
    - "Widget list items have staggered entrance animations (Y-axis + opacity, RTL-safe)"
    - "All widget data comes from existing loadDashboardData() state — no new API calls"
  artifacts:
    - path: "src/components/dashboard/widgets/MiniCalendarWidget.tsx"
      provides: "Compact Hebrew calendar widget using existing Calendar.tsx component"
      contains: "MiniCalendarWidget"
    - path: "src/components/dashboard/widgets/UpcomingEventsWidget.tsx"
      provides: "Upcoming events list widget with entity-colored event items"
      contains: "UpcomingEventsWidget"
    - path: "src/components/dashboard/widgets/RecentActivityWidget.tsx"
      provides: "Recent activity feed widget with color-coded activity items"
      contains: "RecentActivityWidget"
    - path: "src/components/dashboard/widgets/index.ts"
      provides: "Barrel exports for all 3 widget components"
      contains: "export"
    - path: "src/pages/Dashboard.tsx"
      provides: "Dashboard overview right column populated with 3 widget components"
      contains: "MiniCalendarWidget"
  key_links:
    - from: "src/pages/Dashboard.tsx"
      to: "src/components/dashboard/widgets/index.ts"
      via: "import of widget components"
      pattern: "from.*dashboard/widgets"
    - from: "src/components/dashboard/widgets/MiniCalendarWidget.tsx"
      to: "src/components/ui/Calendar.tsx"
      via: "import of existing Calendar component"
      pattern: "from.*ui/Calendar"
---

<objective>
Create three right-column widget components (MiniCalendarWidget, UpcomingEventsWidget, RecentActivityWidget) and wire them into the Dashboard overview tab's right column, replacing the inline placeholder content from Plan 19-01. Add staggered list animations to widget content items.

Purpose: Populate the persistent right sidebar column with contextual, data-rich widgets that make the dashboard feel like a SchoolHub-level command center with always-visible calendar, upcoming items, and activity feed.

Output: Three new widget component files in `src/components/dashboard/widgets/`, a barrel export file, and Dashboard.tsx updated to import and render these widgets in the right column with animation.
</objective>

<execution_context>
@/home/yona279/.claude/get-shit-done/workflows/execute-plan.md
@/home/yona279/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-dashboard-transformation/19-01-SUMMARY.md
@.planning/phases/19-dashboard-transformation/19-RESEARCH.md
@src/components/ui/Calendar.tsx
@src/pages/Dashboard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create widget components and barrel export</name>
  <files>
    src/components/dashboard/widgets/MiniCalendarWidget.tsx
    src/components/dashboard/widgets/UpcomingEventsWidget.tsx
    src/components/dashboard/widgets/RecentActivityWidget.tsx
    src/components/dashboard/widgets/index.ts
  </files>
  <action>
Create the `src/components/dashboard/widgets/` directory and four files:

**1. MiniCalendarWidget.tsx**

A compact wrapper around the existing `src/components/ui/Calendar.tsx` component. Calendar.tsx already handles Hebrew month names, Hebrew day names, and month navigation. The widget wraps it in a Card with a title header.

```tsx
import Calendar from '../../ui/Calendar'
import { Card } from '../../ui/Card'

interface MiniCalendarWidgetProps {
  events?: Record<string, any[]>
}

export function MiniCalendarWidget({ events = {} }: MiniCalendarWidgetProps) {
  return (
    <Card className="p-4">
      <h3 className="text-sm font-semibold text-foreground mb-3">לוח שנה</h3>
      <Calendar events={events} />
    </Card>
  )
}
```

Calendar.tsx uses `date.toDateString()` as the events key (confirmed from `isToday` comparison on line 56-58). Events passed from Dashboard can use this format but will initially be empty (calendar works fine with no events — shows current month grid).

**2. UpcomingEventsWidget.tsx**

A list of upcoming rehearsals/events with entity-colored item cards. Uses `motion` for staggered list entrance.

```tsx
import { Card } from '../../ui/Card'
import { Music } from 'lucide-react'
import { motion } from 'framer-motion'

interface UpcomingEvent {
  title: string
  date: string
  description: string
  isPrimary: boolean
}

interface UpcomingEventsWidgetProps {
  events: UpcomingEvent[]
  loading: boolean
}

const listVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: { staggerChildren: 0.05 }
  }
}

const listItemVariants = {
  hidden: { y: 8, opacity: 0 },
  visible: { y: 0, opacity: 1, transition: { duration: 0.15 } }
}

export function UpcomingEventsWidget({ events, loading }: UpcomingEventsWidgetProps) {
  return (
    <Card className="p-4">
      <div className="flex items-center justify-between mb-3">
        <h3 className="text-sm font-semibold text-foreground">אירועים קרובים</h3>
      </div>
      <div className="space-y-3 max-h-[240px] overflow-y-auto">
        {loading ? (
          <div className="text-xs text-muted-foreground text-center py-4">טוען...</div>
        ) : events.length === 0 ? (
          <div className="text-xs text-muted-foreground text-center py-4">אין אירועים קרובים</div>
        ) : (
          <motion.div
            className="space-y-3"
            variants={listVariants}
            initial="hidden"
            animate="visible"
          >
            {events.map((event, i) => (
              <motion.div
                key={i}
                variants={listItemVariants}
                className="flex items-start gap-3 p-2.5 rounded-lg bg-muted/40"
              >
                <div className="w-7 h-7 rounded-md bg-orchestras-bg flex items-center justify-center flex-shrink-0">
                  <Music className="w-3.5 h-3.5 text-orchestras-fg" />
                </div>
                <div className="flex-1 min-w-0">
                  <p className="text-xs font-medium text-foreground truncate">{event.title}</p>
                  <p className="text-xs text-muted-foreground">{event.date} · {event.description}</p>
                </div>
              </motion.div>
            ))}
          </motion.div>
        )}
      </div>
    </Card>
  )
}
```

Key: Uses `bg-orchestras-bg` and `text-orchestras-fg` entity colors for the event icon. Y-axis only for animation (MOTN-04). Shorter stagger (50ms) than stat cards (80ms) since list items are smaller.

**3. RecentActivityWidget.tsx**

A compact activity feed with color-coded dots and truncated text. Uses `motion` for staggered entrance.

```tsx
import { Card } from '../../ui/Card'
import { motion } from 'framer-motion'

interface Activity {
  type: string
  title: string
  description: string
  time: string
  color: string
}

interface RecentActivityWidgetProps {
  activities: Activity[]
  loading: boolean
}

const listVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: { staggerChildren: 0.05 }
  }
}

const listItemVariants = {
  hidden: { y: 8, opacity: 0 },
  visible: { y: 0, opacity: 1, transition: { duration: 0.15 } }
}

export function RecentActivityWidget({ activities, loading }: RecentActivityWidgetProps) {
  return (
    <Card className="p-4">
      <div className="flex items-center justify-between mb-3">
        <h3 className="text-sm font-semibold text-foreground">פעילות אחרונה</h3>
      </div>
      <div className="space-y-3 max-h-[280px] overflow-y-auto">
        {loading ? (
          <div className="text-xs text-muted-foreground text-center py-4">טוען...</div>
        ) : activities.length === 0 ? (
          <div className="text-xs text-muted-foreground text-center py-4">אין פעילות אחרונה</div>
        ) : (
          <motion.div
            className="space-y-3"
            variants={listVariants}
            initial="hidden"
            animate="visible"
          >
            {activities.map((activity, i) => (
              <motion.div
                key={i}
                variants={listItemVariants}
                className="flex items-start gap-3 p-2.5 rounded-lg hover:bg-muted/30 transition-colors"
              >
                <div className={`w-2 h-2 rounded-full mt-1.5 flex-shrink-0 ${
                  activity.color === 'primary' ? 'bg-students-fg' : 'bg-orchestras-fg'
                }`} />
                <div className="flex-1 min-w-0">
                  <p className="text-xs font-medium text-foreground truncate">{activity.title}</p>
                  <p className="text-xs text-muted-foreground truncate">{activity.description}</p>
                  <p className="text-xs text-muted-foreground/60 mt-0.5">{activity.time}</p>
                </div>
              </motion.div>
            ))}
          </motion.div>
        )}
      </div>
    </Card>
  )
}
```

Key: Uses entity fg colors for activity dots (`bg-students-fg` for student activities, `bg-orchestras-fg` for rehearsal activities). Text is truncated with `truncate` for compact display. Max height with overflow for scrollability.

**4. index.ts (barrel export)**

```ts
export { MiniCalendarWidget } from './MiniCalendarWidget'
export { UpcomingEventsWidget } from './UpcomingEventsWidget'
export { RecentActivityWidget } from './RecentActivityWidget'
```

Important implementation notes:
- No new API calls — all data flows as props from Dashboard.tsx's existing state
- No `layout` prop on motion containers (Radix dropdown conflict avoidance)
- No X-axis transforms in animation variants (MOTN-04 RTL safety)
- Use `bg-muted/40` for item backgrounds (on white Card surface, this is solid enough per 18-02 decision)
- All text is Hebrew hardcoded (no i18n)
  </action>
  <verify>Confirm all 4 files exist: `ls src/components/dashboard/widgets/`. Read each file and verify: (1) MiniCalendarWidget imports from `../../ui/Calendar`, (2) UpcomingEventsWidget uses `motion` with Y-axis only variants, (3) RecentActivityWidget uses entity fg colors for dots, (4) index.ts exports all 3 components.</verify>
  <done>Three widget components and barrel export exist in src/components/dashboard/widgets/. Each widget is a pure display component receiving props, using entity colors and RTL-safe stagger animations.</done>
</task>

<task type="auto">
  <name>Task 2: Wire widget components into Dashboard right column</name>
  <files>src/pages/Dashboard.tsx</files>
  <action>
Update Dashboard.tsx to import the 3 widget components and replace the inline right-column content (placed by Plan 19-01) with the actual widget components.

**Step 1: Add widget import**

Add near the top of Dashboard.tsx with other imports:

```tsx
import { MiniCalendarWidget, UpcomingEventsWidget, RecentActivityWidget } from '../components/dashboard/widgets'
```

**Step 2: Replace the right column content**

In the overview tab's 3-column grid, find the right column div (`<div className="space-y-4">`) and replace its entire content with:

```tsx
{/* Right widget column */}
<div className="space-y-4">
  <MiniCalendarWidget />
  <UpcomingEventsWidget events={upcomingEvents} loading={loading} />
  <RecentActivityWidget activities={recentActivities} loading={loading} />
</div>
```

Key wiring details:
- `MiniCalendarWidget` receives no events prop for now (calendar shows month grid without event dots — events mapping can be enhanced later)
- `UpcomingEventsWidget` receives `upcomingEvents` (already set in `loadDashboardData()` at line ~181) and `loading` state
- `RecentActivityWidget` receives `recentActivities` (already set in `loadDashboardData()` at line ~178) and `loading` state
- All data comes from existing state variables — zero new API calls

**Step 3: Remove any leftover inline widget content**

If Plan 19-01 left inline Card-based event/activity sections in the right column, remove those entirely. The widget components now own that rendering.

Do NOT modify: the main column content (stat cards, DailyTeacherRoomTable, charts), any other tab content, the header, the tab navigation, the data loading logic, the AdminHoursOverview component, or the animation variants.
  </action>
  <verify>Read Dashboard.tsx and confirm: (1) import from `../components/dashboard/widgets` is present, (2) right column contains `<MiniCalendarWidget />`, `<UpcomingEventsWidget events={upcomingEvents} loading={loading} />`, `<RecentActivityWidget activities={recentActivities} loading={loading} />`, (3) no inline Card-based event/activity content remains in the right column, (4) main column and other tabs are unchanged.</verify>
  <done>Dashboard overview tab right column renders 3 dedicated widget components (MiniCalendarWidget, UpcomingEventsWidget, RecentActivityWidget) receiving data from existing dashboard state. No new API calls, no changes to other tabs.</done>
</task>

</tasks>

<verification>
1. `ls src/components/dashboard/widgets/` — confirms 4 files exist (3 widgets + index.ts)
2. `grep -n "MiniCalendarWidget\|UpcomingEventsWidget\|RecentActivityWidget" src/pages/Dashboard.tsx` — confirms all 3 widgets imported and used
3. `grep -n "from.*dashboard/widgets" src/pages/Dashboard.tsx` — confirms import path
4. `grep -rn "listVariants\|listItemVariants" src/components/dashboard/widgets/` — confirms stagger animation in widget components
5. `grep -rn "import.*Calendar" src/components/dashboard/widgets/MiniCalendarWidget.tsx` — confirms Calendar.tsx reuse
6. Verify no `fetch`, `apiService`, or `axios` calls exist in widget files: `grep -rn "fetch\|apiService\|axios" src/components/dashboard/widgets/` should return empty
7. Verify no X-axis transforms: `grep -rn "x:" src/components/dashboard/widgets/` should return empty
</verification>

<success_criteria>
- MiniCalendarWidget renders Hebrew calendar month grid in the right column
- UpcomingEventsWidget renders upcoming events list with entity-colored items and stagger animation
- RecentActivityWidget renders activity feed with color-coded dots and stagger animation
- All widget data comes from existing Dashboard state (no new API calls)
- Widget list items use Y-axis + opacity stagger animations (RTL-safe)
- Dashboard right column is fully populated with 3 meaningful widgets
- Non-overview tabs are completely unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/19-dashboard-transformation/19-02-SUMMARY.md`
</output>
