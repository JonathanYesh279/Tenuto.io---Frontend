---
phase: 11-detail-pages
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - src/features/orchestras/details/components/OrchestraDetailsPage.tsx
  - src/pages/BagrutDetails.tsx
autonomous: true

must_haves:
  truths:
    - "Orchestra detail page shows a warm gradient strip header with orchestra name initials and member count badge"
    - "Orchestra breadcrumb reads '×ª×–××•×¨×•×ª > ×©× ×ª×–××•×¨×ª' and links back to /orchestras"
    - "Bagrut detail page shows a warm gradient strip header with student initials and status badge"
    - "Bagrut breadcrumb reads '×‘×’×¨×•×™×•×ª > ×‘×’×¨×•×ª - ×©× ×ª×œ××™×“' and links back to /bagruts"
    - "'×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”' appears on Orchestra and Bagrut pages when updatedAt exists"
    - "Switching tabs on Orchestra page shows 200ms fade transition"
    - "Switching tabs on Bagrut page shows 200ms fade transition"
  artifacts:
    - path: "src/features/orchestras/details/components/OrchestraDetailsPage.tsx"
      provides: "Orchestra detail page with DetailPageHeader and tab fade"
      contains: "DetailPageHeader"
    - path: "src/pages/BagrutDetails.tsx"
      provides: "Bagrut detail page with DetailPageHeader and tab fade"
      contains: "DetailPageHeader"
  key_links:
    - from: "src/features/orchestras/details/components/OrchestraDetailsPage.tsx"
      to: "src/components/domain/DetailPageHeader.tsx"
      via: "import DetailPageHeader"
      pattern: "DetailPageHeader"
    - from: "src/pages/BagrutDetails.tsx"
      to: "src/components/domain/DetailPageHeader.tsx"
      via: "import DetailPageHeader"
      pattern: "DetailPageHeader"
---

<objective>
Wire DetailPageHeader and tab fade transitions into Orchestra and Bagrut detail pages, completing all 4 entity detail views with consistent gradient headers, breadcrumbs, and tab animations.

Purpose: Every detail page in the app now has the same branded header structure â€” no inconsistencies between entity types.
Output: Upgraded OrchestraDetailsPage and BagrutDetails with DetailPageHeader and AnimatePresence tab fades.
</objective>

<execution_context>
@/home/yona279/.claude/get-shit-done/workflows/execute-plan.md
@/home/yona279/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-detail-pages/11-RESEARCH.md
@.planning/phases/11-detail-pages/11-01-SUMMARY.md
@src/components/domain/DetailPageHeader.tsx
@src/features/orchestras/details/components/OrchestraDetailsPage.tsx
@src/pages/BagrutDetails.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire DetailPageHeader and tab fade into Orchestra detail page</name>
  <files>
    src/features/orchestras/details/components/OrchestraDetailsPage.tsx
  </files>
  <action>
**1. Add imports:**
- `import { DetailPageHeader } from '@/components/domain'`
- `import { AnimatePresence, motion } from 'framer-motion'`

**2. Remove the inline breadcrumb nav** (lines ~153-164 with `×ª×–××•×¨×•×ª` + `>` + name).

**3. Remove the inline white card header** (lines ~167-184 with emoji icon `ğŸ¼`, name, type/location, member count badge).

**4. Replace with DetailPageHeader:**
```tsx
<DetailPageHeader
  fullName={orchestra?.name}
  entityType="×ª×–××•×¨×ª"
  breadcrumbLabel="×ª×–××•×¨×•×ª"
  breadcrumbHref="/orchestras"
  updatedAt={orchestra?.updatedAt}
  badges={
    <>
      <span className="px-3 py-1 bg-white/20 rounded-full text-sm font-medium">
        {orchestra?.type || '×ª×–××•×¨×ª'}
      </span>
      <span className="px-3 py-1 bg-white/20 rounded-full text-sm font-medium">
        {orchestra?.memberIds?.length || 0} ×—×‘×¨×™×
      </span>
    </>
  }
/>
```

Note: Orchestra has `name` not `firstName`/`lastName`. Pass only `fullName={orchestra?.name}`. The `getDisplayName` fallback in DetailPageHeader handles this â€” it will show the name and `getInitials` in nameUtils handles single-name strings (takes first letter).

**5. Tab fade animation** â€” Replace all TabsContent blocks with AnimatePresence + motion.div + conditional rendering:
```tsx
<AnimatePresence mode="wait">
  <motion.div
    key={activeTab}
    initial={{ opacity: 0 }}
    animate={{ opacity: 1 }}
    exit={{ opacity: 0 }}
    transition={{ duration: 0.2 }}
  >
    {activeTab === 'personal' && (
      <PersonalInfoTab orchestraId={orchestraId} orchestra={orchestra} isLoading={false} activeTab={activeTab} />
    )}
    {activeTab === 'members' && (
      <MembersTab orchestraId={orchestraId} orchestra={orchestra} isLoading={false} activeTab={activeTab} onUpdate={fetchOrchestra} />
    )}
    {activeTab === 'schedule' && (
      <ScheduleTab orchestraId={orchestraId} orchestra={orchestra} isLoading={false} activeTab={activeTab} />
    )}
  </motion.div>
</AnimatePresence>
```

Remove all `<TabsContent>` wrappers from the content area. Keep TabsList + TabsTrigger as-is (they control the active tab indicator).

**6. Clean up unused imports** â€” Remove `ArrowRight` if no longer used in the main return (check error states first).
  </action>
  <verify>
- `grep "DetailPageHeader" src/features/orchestras/details/components/OrchestraDetailsPage.tsx` shows import and usage
- `grep "AnimatePresence" src/features/orchestras/details/components/OrchestraDetailsPage.tsx` shows at least 1
- `grep "ğŸ¼" src/features/orchestras/details/components/OrchestraDetailsPage.tsx` shows 0 matches in main return (emoji icon removed)
- No `<span>{'>'}</span>` breadcrumb separator remains
  </verify>
  <done>
- OrchestraDetailsPage uses DetailPageHeader with gradient strip, name initials, type and member count badges, breadcrumb "×ª×–××•×¨×•×ª > ×©×", and updatedAt
- Tab switching shows 200ms fade animation via AnimatePresence
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire DetailPageHeader and tab fade into Bagrut detail page</name>
  <files>
    src/pages/BagrutDetails.tsx
  </files>
  <action>
**Key difference: Bagrut uses CUSTOM Tab component, NOT Radix shadcn Tabs.**

BagrutDetails.tsx has its own `Tab` component (inline, lines ~42-61) and uses `{activeTab === 'x' && (...)}` conditional rendering. The animation approach is the SAME (AnimatePresence + motion.div + key), but no Radix TabsContent involved.

**1. Add imports:**
- `import { DetailPageHeader } from '../components/domain'` (note: BagrutDetails is in `src/pages/`, not `src/features/`)
- `import { AnimatePresence, motion } from 'framer-motion'`

**2. Remove the old header** (lines ~741-813). This is the `<div className="flex items-center justify-between bg-white p-6 rounded-lg shadow-sm">` block containing:
- ArrowRight back button
- `<h1>` "×‘×’×¨×•×ª - {student name}"
- Status badge (×”×•×©×œ× / ×‘×ª×”×œ×™×š)
- Teacher/conservatory/date metadata
- Action buttons (complete, export PDF, delete)

**3. Replace with DetailPageHeader:**

The Bagrut header should show the student's name and initials. Entity type is "×‘×’×¨×•×ª". The student data is loaded asynchronously (`student` state), so use optional chaining.

```tsx
<DetailPageHeader
  firstName={student?.personalInfo?.firstName}
  lastName={student?.personalInfo?.lastName}
  fullName={student?.personalInfo?.fullName || getDisplayName(student?.personalInfo)}
  entityType="×‘×’×¨×•×ª"
  breadcrumbLabel="×‘×’×¨×•×™×•×ª"
  breadcrumbHref="/bagruts"
  updatedAt={bagrut?.updatedAt}
  badges={
    <>
      {bagrut.isCompleted ? (
        <span className="px-3 py-1 bg-white/20 rounded-full text-sm font-medium">×”×•×©×œ×</span>
      ) : (
        <span className="px-3 py-1 bg-white/20 rounded-full text-sm font-medium">×‘×ª×”×œ×™×š</span>
      )}
    </>
  }
/>
```

**4. Keep action buttons** â€” The action buttons (complete, export PDF, delete) should be placed in a row below the DetailPageHeader, matching the existing visual hierarchy:
```tsx
<div className="flex justify-end gap-2">
  {/* Keep existing Complete, Export PDF, Delete buttons exactly as they are */}
</div>
```

**5. Keep teacher/conservatory/date metadata** â€” Move the metadata line (teacher name, conservatory, test date) from the old header into a small info bar below the DetailPageHeader, or include it in the badges slot. Simplest approach: include teacher name in a badge:
```tsx
badges={
  <>
    {bagrut.isCompleted ? (
      <span className="px-3 py-1 bg-white/20 rounded-full text-sm font-medium">×”×•×©×œ×</span>
    ) : (
      <span className="px-3 py-1 bg-white/20 rounded-full text-sm font-medium">×‘×ª×”×œ×™×š</span>
    )}
    {teacher && (
      <span className="px-3 py-1 bg-white/20 rounded-full text-sm font-medium">
        ××•×¨×”: {getDisplayName(teacher?.personalInfo)}
      </span>
    )}
  </>
}
```

**6. Tab fade animation** â€” Wrap the existing tab content area in AnimatePresence.

The current structure is:
```tsx
<div className="p-6">
  {activeTab === 'overview' && (...)}
  {activeTab === 'program' && (...)}
  {activeTab === 'presentations' && (...)}
  {/* ... */}
</div>
```

Replace with:
```tsx
<div className="p-6">
  <AnimatePresence mode="wait">
    <motion.div
      key={activeTab}
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      transition={{ duration: 0.2 }}
    >
      {activeTab === 'overview' && (...)}
      {activeTab === 'program' && (...)}
      {activeTab === 'presentations' && (...)}
      {activeTab === 'magen' && (...)}
      {activeTab === 'grading' && (...)}
      {activeTab === 'documents' && (...)}
      {activeTab === 'accompanists' && (...)}
    </motion.div>
  </AnimatePresence>
</div>
```

The Tab component and the `<div className="border-b border-gray-200"><div className="flex overflow-x-auto">` tab bar remain unchanged. Only the content rendering gets the animation wrapper.

**7. Keep the Statistics Cards section** â€” The stats cards grid (lines ~816-852) sits between the header and tabs. Keep them as-is, positioned after the DetailPageHeader and action buttons but before the tab section.

**IMPORTANT:** Do NOT modify the custom `Tab` component definition (lines ~42-61). It still works as the tab trigger UI. Only the content rendering gets AnimatePresence.

**CRITICAL:** This is a large file (~1600 lines). Be surgical â€” only modify the header block and the content rendering wrapper. Do not touch tab content internals, modal definitions, handlers, or state management.
  </action>
  <verify>
- `grep "DetailPageHeader" src/pages/BagrutDetails.tsx` shows import and usage
- `grep "AnimatePresence" src/pages/BagrutDetails.tsx` shows at least 1
- `grep "motion.div" src/pages/BagrutDetails.tsx` shows at least 1
- Old `<ArrowRight>` back button in the header is removed (ArrowRight may still exist in error state)
- Old `<h1>` "×‘×’×¨×•×ª - {name}" inline in bg-white header is removed
- The custom Tab component definition is still present (it's the tab trigger UI)
  </verify>
  <done>
- BagrutDetails uses DetailPageHeader with student initials avatar, "×‘×’×¨×•×ª" entity type, "×‘×’×¨×•×™×•×ª" breadcrumb, status badge, teacher badge, and updatedAt
- Tab content has 200ms fade animation via AnimatePresence wrapping the conditional rendering block
- Action buttons (complete, export, delete) preserved in a row below the header
- Stats cards section preserved between header and tabs
- Custom Tab component untouched
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `grep -r "DetailPageHeader" src/features/orchestras/ src/pages/BagrutDetails.tsx` â€” shows imports in both
2. `grep -r "AnimatePresence" src/features/orchestras/ src/pages/BagrutDetails.tsx` â€” shows animation in both
3. All 4 detail pages now import DetailPageHeader (Teacher, Student from Plan 11-01; Orchestra, Bagrut from this plan)
4. `grep -r "from-primary-500" src/features/orchestras/details/components/OrchestraDetailsPage.tsx src/pages/BagrutDetails.tsx` â€” returns empty (no hardcoded blue in new code)
5. Custom Tab component still exists in BagrutDetails.tsx (not accidentally deleted)
</verification>

<success_criteria>
- Orchestra detail page has warm gradient header with name initials, type/member badges, breadcrumb, updatedAt, and 200ms tab fade
- Bagrut detail page has warm gradient header with student initials, status/teacher badges, breadcrumb, updatedAt, and 200ms tab fade
- All 4 detail pages (Teacher, Student, Orchestra, Bagrut) now use DetailPageHeader for consistent branding
- No regressions in Bagrut tab content (7 tabs all still render correctly)
- No regressions in Orchestra tab content (3 tabs all still render correctly)
</success_criteria>

<output>
After completion, create `.planning/phases/11-detail-pages/11-02-SUMMARY.md`
</output>
