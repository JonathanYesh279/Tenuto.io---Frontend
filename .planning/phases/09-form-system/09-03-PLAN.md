---
phase: 09-form-system
plan: 03
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/components/forms/StudentForm.tsx
autonomous: true

must_haves:
  truths:
    - "Every form field in StudentForm has a visible label that stays visible regardless of whether the field has a value"
    - "StudentForm uses shadcn Select (Radix) instead of native <select> for all 8 dropdowns"
    - "StudentForm uses shadcn Input instead of native <input> for text/number/date fields"
    - "StudentForm shows inline red border + error message under the specific field that fails validation"
    - "StudentForm buttons follow consistent RTL pattern: Cancel first in DOM, Save second, flex justify-end gap-3"
    - "StudentForm collapsible sections continue to work correctly — expanding/collapsing does not lose data"
  artifacts:
    - path: "src/components/forms/StudentForm.tsx"
      provides: "Student create/edit form with shadcn primitives and FormField wrapper"
  key_links:
    - from: "src/components/forms/StudentForm.tsx"
      to: "src/components/ui/form-field.tsx"
      via: "import { FormField }"
      pattern: "import.*FormField.*from.*form-field"
    - from: "src/components/forms/StudentForm.tsx"
      to: "src/components/ui/select.tsx"
      via: "import { Select, SelectTrigger, ... }"
      pattern: "import.*Select.*from.*ui/select"
---

<objective>
Migrate StudentForm to use consistent shadcn/ui-styled components wrapped in FormField, replacing all native inputs and selects while preserving the existing collapsible-section architecture and useState-based state management.

Purpose: StudentForm is the largest form (1813 lines) with collapsible accordion sections. It does NOT need React Hook Form migration (no tabs = no unmount data loss risk). The migration is pure UI primitive swap: native inputs → shadcn Input, native selects → shadcn Select, native checkboxes → shadcn Checkbox, all wrapped in FormField for consistent labels and inline validation.

Output: StudentForm fully migrated to shadcn primitives with consistent labels, inline validation, and design token colors.
</objective>

<execution_context>
@/home/yona279/.claude/get-shit-done/workflows/execute-plan.md
@/home/yona279/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-form-system/09-RESEARCH.md
@.planning/phases/09-form-system/09-01-SUMMARY.md

@src/components/forms/StudentForm.tsx
@src/components/ui/form-field.tsx
@src/components/ui/input.tsx
@src/components/ui/select.tsx
@src/components/ui/checkbox.tsx
@src/components/ui/textarea.tsx
@src/components/ui/button.tsx
@src/components/ui/separator.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate StudentForm to shadcn primitives with FormField wrapper</name>
  <files>
    src/components/forms/StudentForm.tsx
  </files>
  <action>
**This is a large file (~1813 lines). Work section-by-section through the collapsible sections.**

**Architectural decision: Keep useState, do NOT migrate to RHF.** StudentForm uses collapsible accordion sections (not tabs). Sections collapse/expand via `expandedSections` state, but the form data remains in `useState` throughout — no unmount data loss. RHF migration is unnecessary and risky for a file this size.

**Step 1: Add imports**

Add at the top:
```typescript
import { Input } from '@/components/ui/input'
import { Button } from '@/components/ui/button'
import { Checkbox } from '@/components/ui/checkbox'
import { Label } from '@/components/ui/label'
import { Separator } from '@/components/ui/separator'
import { FormField } from '@/components/ui/form-field'
import {
  Select, SelectTrigger, SelectValue, SelectContent,
  SelectItem, SelectGroup, SelectLabel
} from '@/components/ui/select'
import { cn } from '@/lib/utils'
```

**Step 2: Replace all 8 native `<select>` elements with shadcn Select**

Scan for every `<select` in the file. Each becomes a shadcn Select:

For simple enum selects (class, stage, day, duration, instrument, test status):
```tsx
<FormField label="כיתה" htmlFor="class" error={errors.class}>
  <Select
    value={formData.class || undefined}
    onValueChange={(val) => handleChange('class', val)}
  >
    <SelectTrigger id="class" className={cn(errors.class && "border-destructive")}>
      <SelectValue placeholder="בחר כיתה" />
    </SelectTrigger>
    <SelectContent>
      {VALID_CLASSES.map(c => (
        <SelectItem key={c} value={c}>{c}</SelectItem>
      ))}
    </SelectContent>
  </Select>
</FormField>
```

For teacher assignment selects (which have complex teacher object mapping):
```tsx
<FormField label="מורה" htmlFor="teacher" error={errors.teacher}>
  <Select
    value={selectedTeacherId || undefined}
    onValueChange={(val) => handleTeacherSelect(val)}
  >
    <SelectTrigger id="teacher">
      <SelectValue placeholder="בחר מורה" />
    </SelectTrigger>
    <SelectContent>
      {availableTeachers.map(teacher => (
        <SelectItem key={teacher._id} value={teacher._id}>
          {getDisplayName(teacher)}
        </SelectItem>
      ))}
    </SelectContent>
  </Select>
</FormField>
```

**CRITICAL for numeric selects (stage, duration):** Radix Select values are always strings. When the form expects a number (stage: 1-8, duration: 30/45/60), convert at the boundary:
```tsx
onValueChange={(val) => handleChange('stage', val ? parseInt(val) : null)}
```
And pass value as string:
```tsx
value={formData.stage?.toString() || undefined}
```

**Step 3: Replace all native `<input>` elements with shadcn Input**

Every `<input type="text">`, `<input type="email">`, `<input type="tel">`, `<input type="number">`, `<input type="date">` becomes shadcn Input wrapped in FormField:

```tsx
<FormField label="שם פרטי" htmlFor="firstName" error={errors.firstName} required>
  <Input
    id="firstName"
    value={formData.firstName}
    onChange={(e) => handleChange('firstName', e.target.value)}
    aria-invalid={!!errors.firstName}
    aria-describedby={errors.firstName ? 'firstName-error' : undefined}
    className={cn(errors.firstName && "border-destructive focus-visible:ring-destructive")}
    placeholder="הכנס שם פרטי"
  />
</FormField>
```

For time inputs (`<input type="time">`), pass type="time" to Input — shadcn Input accepts all HTML input types.

**Step 4: Replace native checkboxes with shadcn Checkbox**

For each `<input type="checkbox">`:
```tsx
<div className="flex items-center gap-2">
  <Checkbox
    id="isActive"
    checked={formData.isActive}
    onCheckedChange={(checked) => handleChange('isActive', checked as boolean)}
  />
  <Label htmlFor="isActive">תלמיד פעיל</Label>
</div>
```

**Step 5: Replace native buttons with shadcn Button**

- Cancel: `<Button type="button" variant="outline" onClick={onCancel} disabled={loading}>ביטול</Button>`
- Save: `<Button type="submit" disabled={loading}><Save className="w-4 h-4 ms-2" />{text}</Button>`
- Add/Remove schedule buttons: `<Button type="button" variant="outline" size="sm" onClick={...}><Plus/Trash2 className="w-4 h-4 ms-1" /></Button>`

Keep existing `flex justify-end gap-3` button container.

**Step 6: Add section headings with Separator**

Each collapsible section already has a heading (the clickable expand/collapse button with ChevronDown/ChevronUp). Within expanded sections, add Separator between logical field groups if the section has multiple distinct groups. Don't over-structure — only add separators where there's a clear logical boundary (e.g., between "student info" and "parent info" within a section).

**Step 7: Replace hardcoded color classes with design tokens**

Apply the same token replacement as OrchestraForm:
- `text-gray-700/500/900` → `text-foreground` / `text-muted-foreground`
- `border-gray-200/300` → `border-border` / `border-input`
- `bg-white` → `bg-background` / `bg-card`
- `border-red-300` → `border-destructive`
- `text-red-500/600` → `text-destructive`
- `hover:bg-gray-100/50` → `hover:bg-muted`
- `bg-gray-50` → `bg-muted/50` or `bg-muted`
- `focus:ring-primary-500` → handled by shadcn Input's built-in focus ring

**Step 8: Add aria-invalid and aria-describedby to all inputs with error states**

For every input that has an associated error in the `errors` state object, add:
- `aria-invalid={!!errors.fieldName}`
- `aria-describedby={errors.fieldName ? 'fieldName-error' : undefined}`

The FormField wrapper already renders the error with `id={htmlFor}-error`, so the describedby ID matches.

**Do NOT:**
- Migrate to React Hook Form (useState is correct for this form)
- Change the collapsible section expand/collapse logic
- Modify the teacher assignment workflow (search, select, assign)
- Change the form submission logic or data shape
- Remove the ConfirmationModal import/usage (used for unsaved changes warning)
- Change the component's prop interface
  </action>
  <verify>
1. Run `npx tsc --noEmit 2>&1 | grep "StudentForm" | head -20` — zero TypeScript errors
2. Run `grep -c '<select' src/components/forms/StudentForm.tsx` — should return 0
3. Run `grep -c 'FormField' src/components/forms/StudentForm.tsx` — should be >= 8
4. Run `grep -c 'border-red-300\|text-red-500\|text-red-600\|border-gray-300\|bg-gray-50' src/components/forms/StudentForm.tsx` — should be 0 or near-0
5. Run `grep 'aria-invalid' src/components/forms/StudentForm.tsx | wc -l` — should be > 0
6. Run `grep -c 'Button' src/components/forms/StudentForm.tsx` — should be >= 3
  </verify>
  <done>
StudentForm uses FormField wrapper for all fields with visible labels and inline error messages. All native `<select>` replaced with shadcn Radix Select. All native `<input>` replaced with shadcn Input. Native checkboxes replaced with shadcn Checkbox. Buttons use shadcn Button. Collapsible section architecture unchanged. Hardcoded colors replaced with design tokens. Accessibility attributes (aria-invalid, aria-describedby) wired on all error-capable inputs. Button placement follows RTL-correct flex justify-end gap-3 pattern.
  </done>
</task>

</tasks>

<verification>
1. Zero native `<select>` in StudentForm (`grep -c '<select' src/components/forms/StudentForm.tsx` = 0)
2. All fields wrapped in FormField (`grep -c 'FormField' src/components/forms/StudentForm.tsx` >= 8)
3. Design tokens used (minimal hardcoded gray/red classes)
4. Accessibility attributes present on inputs
5. TypeScript compiles without errors
6. Buttons use shadcn Button components
</verification>

<success_criteria>
- Every field has a visible label via FormField wrapper
- All dropdowns use shadcn Radix Select (no native selects)
- Inline validation shows red border + error message
- Collapsible sections still expand/collapse without data loss
- Buttons are shadcn Button with consistent RTL placement
</success_criteria>

<output>
After completion, create `.planning/phases/09-form-system/09-03-SUMMARY.md`
</output>
