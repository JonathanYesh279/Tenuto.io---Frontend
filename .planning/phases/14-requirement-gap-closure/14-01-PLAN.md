---
phase: 14-requirement-gap-closure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/features/students/details/components/StudentDetailsPageSimple.tsx
autonomous: true

must_haves:
  truths:
    - "Student detail page shows warm gradient header strip with avatar initials and deterministic avatar color"
    - "Student detail page has breadcrumb navigation linking back to /students"
    - "Student detail page shows 'עודכן לאחרונה' metadata beneath entity name"
    - "Tab switching on student detail page shows 200ms fade animation (not instant swap)"
    - "Student detail page header matches Teacher/Orchestra/Bagrut detail page header treatment"
  artifacts:
    - path: "src/features/students/details/components/StudentDetailsPageSimple.tsx"
      provides: "Student detail page with DetailPageHeader, AnimatePresence tab fade"
      contains: "DetailPageHeader"
  key_links:
    - from: "StudentDetailsPageSimple.tsx"
      to: "@/components/domain/DetailPageHeader"
      via: "import { DetailPageHeader } from '@/components/domain'"
      pattern: "DetailPageHeader"
    - from: "StudentDetailsPageSimple.tsx"
      to: "framer-motion"
      via: "AnimatePresence + motion.div wrapping conditional tab content"
      pattern: "AnimatePresence"
---

<objective>
Port DetailPageHeader and AnimatePresence tab fade into StudentDetailsPageSimple.tsx — giving the student detail page the same warm gradient header, deterministic avatar colors, breadcrumb, updatedAt metadata, and 200ms tab fade animation that Teacher/Orchestra/Bagrut already have.

Purpose: Close DETAIL-01 through DETAIL-05 gaps for the Student entity — the only detail page still showing a plain white header with no tab transition animation.

Output: StudentDetailsPageSimple.tsx updated in-place with DetailPageHeader + AnimatePresence pattern from TeacherDetailsPage.
</objective>

<execution_context>
@/home/yona279/.claude/get-shit-done/workflows/execute-plan.md
@/home/yona279/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/14-requirement-gap-closure/14-RESEARCH.md
@src/features/teachers/details/components/TeacherDetailsPage.tsx (reference implementation — lines 14, 165-185, 215-239)
@src/components/domain/DetailPageHeader.tsx (component API)
@src/features/students/details/components/StudentDetailsPageSimple.tsx (target file)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Port DetailPageHeader and AnimatePresence into StudentDetailsPageSimple</name>
  <files>src/features/students/details/components/StudentDetailsPageSimple.tsx</files>
  <action>
Modify StudentDetailsPageSimple.tsx with the following surgical changes. Use TeacherDetailsPage.tsx (lines 14, 165-185, 215-239) as the reference implementation.

**1. Add imports (top of file):**
- Add: `import { DetailPageHeader } from '@/components/domain'`
- Add: `import { AnimatePresence, motion } from 'framer-motion'`
- Do NOT remove `ArrowRight` from the lucide import — it is still used at line 122 in the student-not-found early return block

**2. Remove manual breadcrumb (lines 131-141):**
Delete the entire `<nav>` block:
```tsx
<nav className="flex items-center gap-2 text-sm text-gray-600">
  ...
</nav>
```
DetailPageHeader renders its own breadcrumb internally — keeping both would create duplicate breadcrumbs.

**3. Replace plain white header (lines 143-164) with DetailPageHeader:**
Delete the entire `<div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">` header block and replace with:
```tsx
<DetailPageHeader
  firstName={student?.personalInfo?.firstName}
  lastName={student?.personalInfo?.lastName}
  fullName={student?.personalInfo?.fullName}
  entityType="תלמיד"
  breadcrumbLabel="תלמידים"
  breadcrumbHref="/students"
  updatedAt={student?.updatedAt}
  badges={
    <>
      <span className="px-3 py-1 bg-white/20 rounded-full text-sm font-medium">
        {student?.isActive ? 'פעיל' : 'לא פעיל'}
      </span>
      <span className="px-3 py-1 bg-white/20 rounded-full text-sm font-medium">
        כיתה {student?.academicInfo?.class || '-'}
      </span>
    </>
  }
/>
```

**4. Replace TabsContent pattern with AnimatePresence (lines 200-239):**
Remove all 7 `<TabsContent>` wrappers. Replace with AnimatePresence + motion.div + conditional rendering, matching TeacherDetailsPage pattern exactly:

```tsx
<AnimatePresence mode="wait">
  <motion.div
    key={activeTab}
    initial={{ opacity: 0 }}
    animate={{ opacity: 1 }}
    exit={{ opacity: 0 }}
    transition={{ duration: 0.2 }}
  >
    {activeTab === 'personal' && (
      <PersonalInfoTab student={student} studentId={studentId} onStudentUpdate={handleStudentUpdate} />
    )}
    {activeTab === 'academic' && (
      <AcademicInfoTab student={student} studentId={studentId} onStudentUpdate={handleStudentUpdate} />
    )}
    {activeTab === 'schedule' && (
      <ScheduleTab student={student} studentId={studentId} isLoading={false} />
    )}
    {activeTab === 'attendance' && <AttendanceTab student={student} />}
    {activeTab === 'orchestra' && (
      <OrchestraTab student={student} studentId={studentId} isLoading={false} />
    )}
    {activeTab === 'theory' && (
      <TheoryTabOptimized student={student} studentId={studentId} />
    )}
    {activeTab === 'documents' && <DocumentsTab student={student} />}
  </motion.div>
</AnimatePresence>
```

Remove the `TabsContent` import from the tabs import line — keep only `Tabs, TabsList, TabsTrigger`.

This follows Phase 11 decision [11-01]: AnimatePresence + conditional rendering replaces Radix TabsContent to avoid hidden-panel DOM accumulation.

**IMPORTANT — Do NOT:**
- Route App.tsx to StudentDetailsPage.tsx (the other file with WebSocket/cascade imports)
- Remove the `useNavigate` import — it may still be used in the error/not-found states
- Change any tab content component props — preserve all existing prop signatures
  </action>
  <verify>
1. Grep for `DetailPageHeader` in StudentDetailsPageSimple.tsx — should appear in import and JSX
2. Grep for `AnimatePresence` in StudentDetailsPageSimple.tsx — should appear in import and JSX
3. Grep for `TabsContent` in StudentDetailsPageSimple.tsx — should NOT appear (removed)
4. Grep for `ArrowRight` in StudentDetailsPageSimple.tsx — should STILL appear in lucide import (used by student-not-found block)
5. Confirm no duplicate breadcrumb: grep for `<nav` in StudentDetailsPageSimple.tsx — should NOT appear
6. `npx tsc --noEmit --pretty 2>&1 | grep -i "StudentDetailsPageSimple"` — zero TypeScript errors in this file
  </verify>
  <done>
Student detail page renders DetailPageHeader with warm gradient strip, avatar initials with deterministic color, breadcrumb to /students, updatedAt metadata, status/class badges, and tab content uses AnimatePresence 200ms fade — matching Teacher/Orchestra/Bagrut detail pages exactly.
  </done>
</task>

</tasks>

<verification>
1. StudentDetailsPageSimple.tsx imports DetailPageHeader from @/components/domain and AnimatePresence from framer-motion
2. No `<TabsContent>` elements remain — all replaced by conditional rendering inside AnimatePresence
3. No duplicate breadcrumb (old manual `<nav>` removed)
4. Build succeeds with no new TypeScript errors in this file
</verification>

<success_criteria>
- Student detail page header shows gradient strip matching Teacher/Orchestra/Bagrut
- Avatar initials use deterministic color hashing (via DetailPageHeader → getAvatarColorClasses)
- Breadcrumb shows "תלמידים → [student name]" linking to /students
- "עודכן לאחרונה" date appears beneath student name
- Tab switching shows 200ms opacity fade animation
</success_criteria>

<output>
After completion, create `.planning/phases/14-requirement-gap-closure/14-01-SUMMARY.md`
</output>
