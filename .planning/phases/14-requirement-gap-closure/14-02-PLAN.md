---
phase: 14-requirement-gap-closure
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/badge.tsx
  - src/components/domain/StatusBadge.tsx
  - src/pages/Teachers.tsx
  - src/pages/Students.tsx
  - src/pages/Bagruts.tsx
  - src/pages/AuditTrail.tsx
autonomous: true

must_haves:
  truths:
    - "Teachers list page imports StatusBadge from domain/ barrel — not from Table.tsx"
    - "Students list page imports StatusBadge from domain/ barrel — not from Table.tsx"
    - "Bagruts list page imports StatusBadge from domain/ barrel — not from Table.tsx"
    - "AuditTrail page uses domain StatusBadge — no hand-rolled getStatusBadge function"
    - "Bagrut statuses (הושלם, בתהליך) render with colored variants — not unstyled outline"
    - "AuditTrail statuses (הצלחה, כשל) render with colored variants — not unstyled outline"
  artifacts:
    - path: "src/components/ui/badge.tsx"
      provides: "completed variant added to badgeVariants CVA"
      contains: "completed"
    - path: "src/components/domain/StatusBadge.tsx"
      provides: "Extended STATUS_VARIANT_MAP with הושלם, בתהליך, הצלחה, כשל"
      contains: "הושלם"
    - path: "src/pages/Teachers.tsx"
      provides: "StatusBadge from domain/ barrel"
      contains: "from '../components/domain'"
    - path: "src/pages/Students.tsx"
      provides: "StatusBadge from domain/ barrel"
      contains: "from '../components/domain'"
    - path: "src/pages/Bagruts.tsx"
      provides: "StatusBadge from domain/ barrel"
      contains: "from '../components/domain'"
    - path: "src/pages/AuditTrail.tsx"
      provides: "StatusBadge from domain/ barrel, getStatusBadge function removed"
      contains: "from '../components/domain'"
  key_links:
    - from: "src/pages/Teachers.tsx"
      to: "src/components/domain/StatusBadge.tsx"
      via: "import { StatusBadge } from '../components/domain'"
      pattern: "StatusBadge.*from.*domain"
    - from: "src/components/domain/StatusBadge.tsx"
      to: "src/components/ui/badge.tsx"
      via: "Badge component with variant prop"
      pattern: "Badge.*variant"
---

<objective>
Extend the domain StatusBadge variant map, add a `completed` variant to badge.tsx, and migrate all list page StatusBadge imports from Table.tsx to the domain/ barrel — making all list pages use the canonical shadcn-backed StatusBadge consistently.

Purpose: Close the PRIM-05 gap — all list pages (Teachers, Students, Bagruts, AuditTrail) should use the domain/StatusBadge with Hebrew status strings mapped to typed Badge variants, not the deprecated Table.tsx StatusBadge or hand-rolled span elements.

Output: 6 files updated — badge.tsx (new variant), StatusBadge.tsx (extended map), 4 pages (import swap + API adjustment).
</objective>

<execution_context>
@/home/yona279/.claude/get-shit-done/workflows/execute-plan.md
@/home/yona279/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/14-requirement-gap-closure/14-RESEARCH.md
@src/components/ui/badge.tsx (current variants)
@src/components/domain/StatusBadge.tsx (current variant map)
@src/components/ui/Table.tsx (deprecated StatusBadge — lines 29-51)
@src/pages/Teachers.tsx (line 5 import, lines 197-199 usage)
@src/pages/Students.tsx (line 6 import, lines 296-299 usage)
@src/pages/Bagruts.tsx (line 9 import, lines 366-368 usage)
@src/pages/AuditTrail.tsx (lines 180-193 getStatusBadge, line 201 column render)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend badge.tsx and domain StatusBadge variant map</name>
  <files>src/components/ui/badge.tsx, src/components/domain/StatusBadge.tsx</files>
  <action>
**1. Add `completed` variant to badge.tsx:**

In the `badgeVariants` CVA `variants.variant` object, add after the `pending` entry:
```tsx
completed: "border-transparent bg-green-100 text-green-800",
```
This is visually identical to `active` — appropriate for completed exams in Bagruts context (green = success/done).

**2. Extend STATUS_VARIANT_MAP in domain/StatusBadge.tsx:**

Add 4 new entries to the existing map:
```tsx
const STATUS_VARIANT_MAP: Record<string, BadgeVariant> = {
  'פעיל': 'active',
  'לא פעיל': 'inactive',
  'בוגר': 'graduated',
  'ממתין': 'pending',
  'הושלם': 'completed',   // Bagruts — completed exam
  'בתהליך': 'pending',    // Bagruts — in-progress (orange)
  'הצלחה': 'active',      // AuditTrail — success (green)
  'כשל': 'destructive',   // AuditTrail — failed (red)
}
```

These 4 additions cover all Hebrew status strings used across Bagruts and AuditTrail pages.
  </action>
  <verify>
1. Grep for `completed:` in badge.tsx — should appear in variants
2. Grep for `הושלם` in StatusBadge.tsx — should appear in STATUS_VARIANT_MAP
3. Grep for `הצלחה` in StatusBadge.tsx — should appear in STATUS_VARIANT_MAP
  </verify>
  <done>
badge.tsx has `completed` variant (green-100/green-800). domain/StatusBadge.tsx maps 8 Hebrew status strings (פעיל, לא פעיל, בוגר, ממתין, הושלם, בתהליך, הצלחה, כשל) to typed Badge variants.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate list page StatusBadge imports to domain barrel</name>
  <files>src/pages/Teachers.tsx, src/pages/Students.tsx, src/pages/Bagruts.tsx, src/pages/AuditTrail.tsx</files>
  <action>
Migrate all 4 pages from Table.tsx StatusBadge to domain/ StatusBadge. The APIs are different: Table.tsx uses English `status` key + `children` for display text; domain/ uses Hebrew `status` string only (renders status as children automatically).

**Teachers.tsx:**
- Change import line 5 from: `import Table, { StatusBadge } from '../components/ui/Table'`
  to: `import Table from '../components/ui/Table'`
- Add new import: `import { StatusBadge } from '../components/domain'`
- Change line 197-199 usage from:
  ```tsx
  <StatusBadge status={teacher.isTeacherActive ? "active" : "inactive"}>
    {teacher.isTeacherActive ? 'פעיל' : 'לא פעיל'}
  </StatusBadge>
  ```
  to:
  ```tsx
  <StatusBadge status={teacher.isTeacherActive ? 'פעיל' : 'לא פעיל'} />
  ```

**Students.tsx:**
- Change import line 6 from: `import Table, { StatusBadge } from '../components/ui/Table'`
  to: `import Table from '../components/ui/Table'`
- Add new import: `import { StatusBadge } from '../components/domain'`
- Line 296 grade badge: The Table.tsx StatusBadge was being used to display grade/class (status="completed") with student.class as children — this is NOT a status, it's a grade label. Replace with a plain Badge:
  ```tsx
  grade: <Badge variant="outline">{student.class}</Badge>,
  ```
  Add `import { Badge } from '../components/ui/badge'` to Students.tsx imports.
- Lines 297-299 status badge: Change from:
  ```tsx
  <StatusBadge status={student.isActive ? "active" : "inactive"}>
    {student.isActive ? 'פעיל' : 'לא פעיל'}
  </StatusBadge>
  ```
  to:
  ```tsx
  <StatusBadge status={student.isActive ? 'פעיל' : 'לא פעיל'} />
  ```

**Bagruts.tsx:**
- Change import line 9 from: `import Table, { StatusBadge } from '../components/ui/Table'`
  to: `import Table from '../components/ui/Table'`
- Add new import: `import { StatusBadge } from '../components/domain'`
- Lines 366-368 usage: Change from:
  ```tsx
  <StatusBadge status="completed">הושלם</StatusBadge>
  ```
  to:
  ```tsx
  <StatusBadge status="הושלם" />
  ```
  And similarly for the pending line:
  ```tsx
  <StatusBadge status="pending">בתהליך</StatusBadge>
  ```
  to:
  ```tsx
  <StatusBadge status="בתהליך" />
  ```

**AuditTrail.tsx:**
- Add import: `import { StatusBadge } from '../components/domain'`
- Delete the entire `getStatusBadge` function (lines 180-193) — the domain StatusBadge handles all this via variant map.
- Update the deletion log column definition (line 201) from:
  ```tsx
  { key: 'status', label: 'סטטוס', render: (row: any) => getStatusBadge(row.status) },
  ```
  to:
  ```tsx
  { key: 'status', label: 'סטטוס', render: (row: any) => <StatusBadge status={row.status === 'success' ? 'הצלחה' : 'כשל'} /> },
  ```

**IMPORTANT — Do NOT:**
- Remove the StatusBadge export from Table.tsx — PresentationTracker.tsx still imports it. That migration is deferred to Phase 15.
- Pass `children` to domain StatusBadge — it renders status as children automatically. Passing children would duplicate the text.
  </action>
  <verify>
1. Grep for `StatusBadge.*from.*Table` across src/pages/ — should return zero matches (no list page imports from Table.tsx)
2. Grep for `StatusBadge.*from.*domain` across src/pages/ — should match Teachers, Students, Bagruts, AuditTrail
3. Grep for `getStatusBadge` in AuditTrail.tsx — should NOT appear (function deleted)
4. Grep for `StatusBadge` in src/components/ui/Table.tsx — should STILL exist (not removed — PresentationTracker uses it)
5. `npx tsc --noEmit --pretty 2>&1 | grep -i "Teachers\|Students\|Bagruts\|AuditTrail"` — zero TypeScript errors in these files
  </verify>
  <done>
All 4 list pages (Teachers, Students, Bagruts, AuditTrail) import StatusBadge from domain/ barrel. Table.tsx StatusBadge still exported for PresentationTracker (deferred to Phase 15). AuditTrail getStatusBadge function removed — uses domain StatusBadge with Hebrew status mapping.
  </done>
</task>

</tasks>

<verification>
1. No list page in src/pages/ imports StatusBadge from Table.tsx
2. All 4 pages (Teachers, Students, Bagruts, AuditTrail) import from domain/
3. badge.tsx has `completed` variant
4. domain/StatusBadge.tsx has 8 entries in STATUS_VARIANT_MAP
5. Table.tsx still exports StatusBadge (not removed)
6. Build succeeds
</verification>

<success_criteria>
- Teachers, Students, Bagruts, AuditTrail all use domain/StatusBadge with Hebrew status strings
- Bagrut statuses (הושלם, בתהליך) render with green/orange Badge variants (not unstyled outline)
- AuditTrail statuses render with green (success) / red (failed) Badge variants
- Table.tsx StatusBadge still available for PresentationTracker (Phase 15 migration)
- No new TypeScript errors introduced
</success_criteria>

<output>
After completion, create `.planning/phases/14-requirement-gap-closure/14-02-SUMMARY.md`
</output>
