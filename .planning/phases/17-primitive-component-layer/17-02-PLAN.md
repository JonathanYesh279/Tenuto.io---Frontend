---
phase: 17-primitive-component-layer
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/dialog.tsx
  - src/components/ui/tabs.tsx
  - src/components/ui/input.tsx
autonomous: true

must_haves:
  truths:
    - "Dialog/modal surfaces display shadow-4 — visually elevated above page content"
    - "Dialog entrance uses Framer Motion spring physics (not linear CSS fade)"
    - "Dialog spring entrance is gated by useReducedMotion() — reduced motion users see instant appearance"
    - "Dialog CSS exit animation is preserved (data-[state=closed] classes kept)"
    - "Modal.tsx wrapper and all 24+ callsites continue to work without any callsite changes"
    - "ConfirmDeleteDialog continues to work without any changes"
    - "Tabs focus ring uses focus-visible:ring-ring consistently"
    - "Input focus ring uses focus-visible:ring-ring consistently"
  artifacts:
    - path: "src/components/ui/dialog.tsx"
      provides: "DialogContent with shadow-4 elevation and Framer Motion spring entrance"
      contains: "shadow-4"
    - path: "src/components/ui/dialog.tsx"
      provides: "Spring entrance animation on DialogContent"
      contains: "useReducedMotion"
    - path: "src/components/ui/tabs.tsx"
      provides: "TabsTrigger with consistent focus ring"
      contains: "focus-visible:ring-ring"
    - path: "src/components/ui/input.tsx"
      provides: "Input with consistent focus ring"
      contains: "focus-visible:ring-ring"
  key_links:
    - from: "src/components/ui/dialog.tsx"
      to: "src/lib/motionTokens.ts"
      via: "import { smooth }"
      pattern: "import.*smooth.*motionTokens"
    - from: "src/components/ui/dialog.tsx"
      to: "framer-motion"
      via: "import { motion, useReducedMotion }"
      pattern: "import.*motion.*framer-motion"
    - from: "src/components/ui/Modal.tsx"
      to: "src/components/ui/dialog.tsx"
      via: "import { DialogContent }"
      pattern: "import.*DialogContent.*dialog"
---

<objective>
Add spring entrance and shadow-4 elevation to Dialog, verify focus rings on Tabs and Input.

Purpose: Dialog/modal surfaces gain perceptible elevation (shadow-4) and spring physics entrance animation via Framer Motion, making modals feel physical rather than appearing with a flat CSS fade. Tabs and Input focus rings are verified as consistent with the ring token system. The Modal.tsx wrapper and all 24+ callsites remain backward-compatible with zero changes.

Output: Updated dialog.tsx with spring entrance + shadow-4, verified tabs.tsx and input.tsx focus rings.
</objective>

<execution_context>
@/home/yona279/.claude/get-shit-done/workflows/execute-plan.md
@/home/yona279/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-token-foundation/16-02-SUMMARY.md
@.planning/phases/17-primitive-component-layer/17-RESEARCH.md
@src/components/ui/dialog.tsx
@src/components/ui/tabs.tsx
@src/components/ui/input.tsx
@src/components/ui/Modal.tsx
@src/components/ui/ConfirmDeleteDialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Dialog spring entrance and shadow-4 elevation</name>
  <files>src/components/ui/dialog.tsx</files>
  <action>
This is the highest-complexity task in Phase 17. Use **Option C (pragmatic)** from research: spring entrance via Framer Motion, CSS exit animation kept.

**Approach:** Use `motion()` (framer-motion v10 API) to create a motion-enhanced version of `DialogPrimitive.Content`. Add spring entrance props. Keep all `data-[state=closed]` CSS exit classes. Keep Radix's internal open state management — do NOT hoist `open` prop.

**Step-by-step changes to dialog.tsx:**

1. **Add imports at top of file:**
   ```tsx
   import { motion, useReducedMotion } from "framer-motion"
   import { smooth } from "@/lib/motionTokens"
   ```

2. **Create motion-enhanced components** after the imports/aliases section (after line 12):
   ```tsx
   // Motion-enhanced Radix primitives for spring entrance animation
   const MotionOverlay = motion(DialogPrimitive.Overlay)
   const MotionContent = motion(DialogPrimitive.Content)
   ```

   **IMPORTANT:** If `motion(DialogPrimitive.Overlay)` causes a TypeScript error in v10, fall back to wrapping with `motion.div` using Radix's `asChild` prop pattern. But try the direct `motion()` wrapper first — it produces a single DOM element (no double-div).

3. **Update DialogOverlay** to use MotionOverlay with spring entrance:
   ```tsx
   const DialogOverlay = React.forwardRef<
     React.ElementRef<typeof DialogPrimitive.Overlay>,
     React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
   >(({ className, ...props }, ref) => {
     const shouldReduceMotion = useReducedMotion() ?? false
     return (
       <MotionOverlay
         ref={ref}
         initial={shouldReduceMotion ? undefined : { opacity: 0 }}
         animate={shouldReduceMotion ? undefined : { opacity: 1 }}
         transition={shouldReduceMotion ? undefined : { duration: 0.15 }}
         className={cn(
           "fixed inset-0 z-50 bg-black/80",
           // Keep CSS exit animation
           "data-[state=closed]:animate-out data-[state=closed]:fade-out-0",
           className
         )}
         {...props}
       />
     )
   })
   ```

   **Key change:** Remove `data-[state=open]:animate-in data-[state=open]:fade-in-0` (replaced by Framer Motion entrance). Keep `data-[state=closed]:animate-out data-[state=closed]:fade-out-0` for CSS exit.

4. **Update DialogContent** to use MotionContent with spring entrance and shadow-4:
   ```tsx
   const DialogContent = React.forwardRef<
     React.ElementRef<typeof DialogPrimitive.Content>,
     React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
   >(({ className, children, ...props }, ref) => {
     const shouldReduceMotion = useReducedMotion() ?? false
     return (
       <DialogPortal>
         <DialogOverlay />
         <MotionContent
           ref={ref}
           initial={shouldReduceMotion ? undefined : { opacity: 0, scale: 0.95, y: -8 }}
           animate={shouldReduceMotion ? undefined : { opacity: 1, scale: 1, y: 0 }}
           transition={shouldReduceMotion ? undefined : smooth}
           className={cn(
             "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-4 duration-200",
             // Keep CSS exit animations
             "data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]",
             // Remove ALL data-[state=open] entrance classes — Framer Motion handles entrance
             className
           )}
           {...props}
         >
           {children}
           <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
             <X className="h-4 w-4" />
             <span className="sr-only">Close</span>
           </DialogPrimitive.Close>
         </MotionContent>
       </DialogPortal>
     )
   })
   ```

   **Key changes in className:**
   - `shadow-lg` replaced with `shadow-4` (warm-tinted token elevation)
   - ALL `data-[state=open]:*` entrance classes removed (replaced by Framer `initial`/`animate`)
   - ALL `data-[state=closed]:*` exit classes KEPT (CSS handles exit)
   - `duration-200` kept for CSS exit animation timing

5. **Do NOT change:**
   - The DialogContent props interface (no new required props — backward compat)
   - The DialogPrimitive.Close button inside DialogContent
   - DialogHeader, DialogFooter, DialogTitle, DialogDescription
   - The exports at the bottom of the file
   - The Dialog and DialogTrigger aliases

**Backward compatibility verification:** Modal.tsx imports `DialogContent` from dialog.tsx and passes `className`, `children`, `onInteractOutside` props. None of these change. The `open` state is managed by `<Dialog open={isOpen}>` in Modal.tsx, which is `DialogPrimitive.Root` — unchanged. ConfirmDeleteDialog uses the same pattern. Both will work without changes.

**Fallback if motion() wrapper fails:** If `motion(DialogPrimitive.Content)` throws a TypeScript error or runtime error in framer-motion v10, revert to keeping `DialogPrimitive.Content` directly and adding the entrance animation via inline `style` prop with a `useEffect` + `requestAnimationFrame` approach. But this is unlikely — `motion()` is the standard v10 API for wrapping third-party components.
  </action>
  <verify>
Run: `grep -n "shadow-4" src/components/ui/dialog.tsx` — should show shadow-4 in DialogContent className.
Run: `grep -n "useReducedMotion" src/components/ui/dialog.tsx` — should appear in both DialogOverlay and DialogContent.
Run: `grep -n "smooth" src/components/ui/dialog.tsx` — should show import from motionTokens and usage as transition.
Run: `grep -n "data-\[state=open\]" src/components/ui/dialog.tsx` — should NOT appear in Overlay or Content classNames (only on Close button's bg-accent which is unrelated to animation).
Run: `grep -n "data-\[state=closed\]" src/components/ui/dialog.tsx` — should still appear for exit animations.
Run: `grep -n "MotionOverlay\|MotionContent" src/components/ui/dialog.tsx` — should show both motion-enhanced components.
Run: `grep -n "shadow-lg" src/components/ui/dialog.tsx` — should NOT appear (replaced by shadow-4).
  </verify>
  <done>
DialogContent uses shadow-4 (warm-tinted elevation). Entrance animation uses Framer Motion spring (smooth preset) with opacity + scale + y transform. Exit animation preserved via CSS data-[state=closed] classes. Both DialogOverlay and DialogContent spring entrances are gated by useReducedMotion(). No new props required — backward compatible with Modal.tsx (24+ callsites) and ConfirmDeleteDialog.
  </done>
</task>

<task type="auto">
  <name>Task 2: Tabs active shadow token and Input/Tabs focus ring verification</name>
  <files>src/components/ui/tabs.tsx, src/components/ui/input.tsx</files>
  <action>
**Tabs changes:**

1. In TabsTrigger className (line 30), replace `data-[state=active]:shadow-sm` with `data-[state=active]:shadow-1` to use the warm-tinted shadow token on the active tab indicator.

   Before: `data-[state=active]:shadow-sm`
   After: `data-[state=active]:shadow-1`

2. **Focus ring verification:** TabsTrigger already has `focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2`. This is correct — it uses the semantic `ring` token. TabsContent also has `focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2`. Both are consistent. No changes needed for focus rings.

**Input changes:**

1. **Focus ring verification:** Input already has `focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2` (line 14). This is correct and consistent with Button and Tabs. No changes needed.

2. No shadow changes for Input — inputs are flat by convention and should not have elevation.

**Summary:** The only actual code change is tabs.tsx `shadow-sm` to `shadow-1`. Input is verified-correct with no modifications.
  </action>
  <verify>
Run: `grep -n "shadow-1" src/components/ui/tabs.tsx` — should show shadow-1 in active state.
Run: `grep -n "shadow-sm" src/components/ui/tabs.tsx` — should NOT appear (replaced).
Run: `grep -n "focus-visible:ring-ring" src/components/ui/tabs.tsx` — should appear in TabsTrigger and TabsContent.
Run: `grep -n "focus-visible:ring-ring" src/components/ui/input.tsx` — should appear in Input.
Run: `grep -n "shadow" src/components/ui/input.tsx` — should NOT appear (inputs stay flat).
  </verify>
  <done>
TabsTrigger active state uses shadow-1 (warm-tinted token) instead of shadow-sm. TabsTrigger, TabsContent, and Input all use focus-visible:ring-ring consistently. Input has no shadow changes (flat by convention).
  </done>
</task>

</tasks>

<verification>
1. `grep -rn "shadow-4" src/components/ui/dialog.tsx` — shadow-4 present on DialogContent
2. `grep -rn "shadow-lg" src/components/ui/dialog.tsx` — should NOT appear
3. `grep -rn "useReducedMotion" src/components/ui/dialog.tsx` — present in both Overlay and Content
4. `grep -rn "smooth" src/components/ui/dialog.tsx` — imported and used as transition
5. `grep -rn "MotionOverlay\|MotionContent" src/components/ui/dialog.tsx` — both defined
6. `grep -rn "data-\[state=open\]:animate-in" src/components/ui/dialog.tsx` — should NOT appear (entrance via FM)
7. `grep -rn "data-\[state=closed\]:animate-out" src/components/ui/dialog.tsx` — should still appear (exit via CSS)
8. `grep -rn "shadow-1" src/components/ui/tabs.tsx` — present in active state
9. `grep -rn "focus-visible:ring-ring" src/components/ui/tabs.tsx src/components/ui/input.tsx` — present in both
10. Modal.tsx and ConfirmDeleteDialog.tsx are NOT in files_modified — zero callsite changes required
</verification>

<success_criteria>
- dialog.tsx: shadow-lg replaced with shadow-4; entrance animation via Framer Motion spring (smooth preset); exit animation preserved via CSS; useReducedMotion() gating on both Overlay and Content
- tabs.tsx: active tab shadow-sm replaced with shadow-1; focus ring verified as ring-ring
- input.tsx: focus ring verified as ring-ring; no shadow changes
- Modal.tsx backward compatibility: zero changes to Modal.tsx or any of its 24+ callsites
- ConfirmDeleteDialog backward compatibility: zero changes
- No new z-index values added
- No new dependencies installed
</success_criteria>

<output>
After completion, create `.planning/phases/17-primitive-component-layer/17-02-SUMMARY.md`
</output>
