---
phase: 14-requirement-gap-closure
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/Rehearsals.tsx
autonomous: true

must_haves:
  truths:
    - "Rehearsals page shows ErrorState component with retry button on network error"
    - "Clicking retry button on Rehearsals error state re-fetches rehearsal data"
    - "ErrorState uses design tokens (text-destructive, text-muted-foreground) not hardcoded red"
  artifacts:
    - path: "src/pages/Rehearsals.tsx"
      provides: "ErrorState with onRetry wired to loadData"
      contains: "ErrorState"
  key_links:
    - from: "src/pages/Rehearsals.tsx"
      to: "src/components/feedback/ErrorState.tsx"
      via: "import { ErrorState } from '../components/feedback/ErrorState'"
      pattern: "ErrorState"
    - from: "ErrorState onRetry"
      to: "loadData function"
      via: "onRetry={loadData} prop"
      pattern: "onRetry.*loadData"
---

<objective>
Replace the inline error HTML block in Rehearsals.tsx with the ErrorState component — adding a retry button that calls loadData() to re-fetch rehearsal data.

Purpose: Close the LOAD-04 gap for Rehearsals — the only list page still using hardcoded inline error HTML instead of the canonical ErrorState component with retry button.

Output: Rehearsals.tsx updated with ErrorState import and wiring.
</objective>

<execution_context>
@/home/yona279/.claude/get-shit-done/workflows/execute-plan.md
@/home/yona279/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/14-requirement-gap-closure/14-RESEARCH.md
@src/components/feedback/ErrorState.tsx (component API)
@src/pages/Rehearsals.tsx (target file — lines 447-454 error block, line 128 loadData)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace Rehearsals inline error with ErrorState component</name>
  <files>src/pages/Rehearsals.tsx</files>
  <action>
**1. Add import:**
Add to the import section (near other component imports around lines 20-30):
```tsx
import { ErrorState } from '../components/feedback/ErrorState'
```

**2. Replace inline error block (lines 447-454):**
Replace:
```tsx
{error && (
  <div className="bg-red-50 border border-red-200 rounded-lg p-4">
    <div className="flex items-center">
      <AlertTriangle className="w-5 h-5 text-red-600 ml-2" />
      <span className="text-red-800">{error}</span>
    </div>
  </div>
)}
```
With:
```tsx
{error && (
  <ErrorState
    message={error}
    onRetry={loadData}
  />
)}
```

`loadData` is already defined at line 128 and is accessible in scope. ErrorState renders an AlertCircle icon, the error message, and a "נסה שוב" (retry) button — all using design tokens (text-destructive, text-muted-foreground).

**3. Optional cleanup:**
Check if `AlertTriangle` is still used elsewhere in Rehearsals.tsx after this change. If not, remove it from the lucide-react import to clean up unused imports. If it IS used elsewhere in the file (check for other `AlertTriangle` references), keep it.
  </action>
  <verify>
1. Grep for `ErrorState` in Rehearsals.tsx — should appear in import and JSX
2. Grep for `bg-red-50` in Rehearsals.tsx — should NOT appear (inline error removed)
3. Grep for `onRetry={loadData}` in Rehearsals.tsx — should appear (retry wired)
4. `npx tsc --noEmit --pretty 2>&1 | grep -i "Rehearsals"` — zero TypeScript errors
  </verify>
  <done>
Rehearsals.tsx error display uses ErrorState component with AlertCircle icon, error message, and "נסה שוב" retry button wired to loadData(). No hardcoded red colors — uses design tokens consistent with Teachers/Students/Orchestras pages.
  </done>
</task>

</tasks>

<verification>
1. ErrorState imported from feedback/ErrorState in Rehearsals.tsx
2. onRetry prop wired to loadData function
3. No inline red error HTML remains
4. Build succeeds
</verification>

<success_criteria>
- Rehearsals page shows ErrorState with retry button on network error
- Retry button triggers loadData() to re-fetch data
- Error display uses design tokens (text-destructive) not hardcoded red
- Consistent with Teachers/Students/Orchestras error handling
</success_criteria>

<output>
After completion, create `.planning/phases/14-requirement-gap-closure/14-03-SUMMARY.md`
</output>
